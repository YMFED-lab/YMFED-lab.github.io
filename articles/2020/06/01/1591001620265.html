<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>新一代 Web 性能体验和质量指标及其提升方法 - 亚美大前端（FED）</title><meta name="description" content="来关注一下 新一代前端性能指标及其优化方法"/><meta property="og:description" content="来关注一下 新一代前端性能指标及其优化方法"/>    <meta name="keywords" content="YM,亚美,前端,博客"/><link rel="dns-prefetch" href="https://ymfed.github.io"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://ymfed.github.io"><link rel="icon" type="image/png" href="http://fed.ym/images/czh-fed-logo.png"/><link rel="apple-touch-icon" href="http://fed.ym/images/czh-fed-logo.png"><link rel="shortcut icon" type="image/x-icon" href="http://fed.ym/images/czh-fed-logo.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="新一代 Web 性能体验和质量指标及其提升方法 - 亚美大前端（FED）"/><meta property="og:site_name" content="亚美大前端（FED）"/><meta property="og:url"      content="https://ymfed.github.io/articles/2020/06/01/1591001620265.html?"/><meta property="og:image" content="http://fed.ym/images/czh-fed-logo.png"/><link rel="search" type="application/opensearchdescription+xml" title="新一代 Web 性能体验和质量指标及其提升方法 - 亚美大前端（FED）" href="/opensearch.xml"><link href="https://ymfed.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://ymfed.github.io/manifest.json">        <link rel="canonical" href="https://ymfed.github.io/articles/2020/06/01/1591001620265.html">        <link rel="stylesheet"
              href="https://ymfed.github.io/skins/9IPHP/css/base.css?1585645466987"/>
            <link rel="prev" title="ECMAScript 2020新特性" href="https://ymfed.github.io/articles/2020/05/29/1590745984415.html">
            <link rel="next" title="BFC知识总结" href="https://ymfed.github.io/articles/2020/06/01/1591015157950.html">
    </head>
<body>
<header>
    <div class="banner">
        <div class="fn-clear wrapper">
            <a href="https://ymfed.github.io" class="logo" rel="start"></a>
            <h2 class="subtitle-wrap">
                <p class="subtitle">亚美大前端（FED）</p>
                <p class="description">既要埋头干事，也要抬头看路</p>
            </h2>
            <div class="fn-right">
                    <a class="fn__flex-inline" href="https://ymfed.github.io/start">
                        <i class="icon-login"></i>&nbsp;开始使用
                    </a>
            </div>
        </div>
    </div>

    <div class="navbar">
        <div class="fn-clear wrapper">
            <nav class="fn-left">
                <a href="https://ymfed.github.io">
                    <i class="icon-home"></i>
                    首页
                </a>
                <a href="https://ymfed.github.io/tags.html" rel="section">
                    <i class="icon-tags"></i> 标签墙
                </a>
                <a href="https://ymfed.github.io/archives.html">
                    <i class="icon-inbox"></i> 存档
                </a>
                <a rel="archive" href="https://ymfed.github.io/links.html">
                    <i class="icon-link"></i> 友情链接
                </a>
                <a rel="archive" href="https://ymfed.github.io/team.html">
                    <i class="icon-category"></i> 团队介绍
                </a>
                <a rel="archive" href="https://ymfed.github.io/join.html">
                    <i class="icon-register"></i> 加入我们
                </a>
            </nav>
            <div class="fn-right">
                <form class="form" action="https://ymfed.github.io/search">
                    <input placeholder="搜索" id="search" type="text" name="keyword"/>
                    <button type="submit"><i class="icon-search"></i></button>
                </form>
            </div>
        </div>
    </div>
</header>
<div class="responsive fn-none">
    <i class="icon-list"></i>
    <ul class="list">
                <li>
                    <a href="https://ymfed.github.io/start">
                        <i class="icon-login"></i> 开始使用
                    </a>
                </li>
        <li>
            <a href="https://ymfed.github.io">
                <i class="icon-home"></i>
                首页
            </a>
        </li>
        <li>
            <a href="https://ymfed.github.io/tags.html" rel="section">
                <i class="icon-tags"></i> 标签墙
            </a>
        </li>
        <li>
            <a href="https://ymfed.github.io/archives.html">
                <i class="icon-inbox"></i> 存档
            </a>
        </li>
        <li>
            <a rel="archive" href="https://ymfed.github.io/links.html">
                <i class="icon-link"></i> 友情链接
            </a>
        </li>
        <li>
            <a rel="archive" href="https://ymfed.github.io/team.html">
                <i class="icon-category"></i> 团队介绍
            </a>
        </li>
        <li>
            <a rel="archive" href="https://ymfed.github.io/join.html">
                <i class="icon-register"></i> 加入我们
            </a>
        </li>
    </ul>
</div><div class="wrapper">
    <div class="main-wrap">
        <main>
            <article class="post">
                <header>
                    <h2>
                        <a rel="bookmark" href="https://ymfed.github.io/articles/2020/06/01/1591001620265.html">
                            新一代 Web 性能体验和质量指标及其提升方法
                        </a>
                    </h2>
                    <div class="meta">
                                <span class="vditor-tooltipped vditor-tooltipped__n"
                                      aria-label="更新日期">
                                    <i class="icon-date"></i>
                                    <time>
                                    2020-06-01
                                    </time>
                                </span>
                        &nbsp; | &nbsp;
                        <span class="vditor-tooltipped vditor-tooltipped__n" aria-label="评论数">
                                    <i class="icon-comments"></i>
                                    <a href="https://ymfed.github.io/articles/2020/06/01/1591001620265.html#b3logsolocomments">
                                        <span data-uvstatcmt="1591001620265">0</span> 评论</a>
                                </span>
                        &nbsp; | &nbsp;
                        <span class="vditor-tooltipped vditor-tooltipped__n" aria-label="浏览数">
                                    <i class="icon-views"></i>
                        <span data-uvstaturl="https://ymfed.github.io/articles/2020/06/01/1591001620265.html">0</span> 浏览
                                </span>
                    </div>
                </header>

                <div class="vditor-reset post__content">
                    <p>衡量一个 <code>Web</code> 页面的体验和质量一直有非常多的工具和指标 ... 每次我们去关注这些指标的时候都会非常痛苦，因为这些指标真的是又多又难理解，测量这些指标的工具也非常多。</p>
<p><img src="https://b3logfile.com/file/2020/06/640-aed88481.png" alt="640.png"></p>
<p>最近发布的 <code>Chrome 83</code> 中又增加了几个性能指标<br>
然而不要着急，这些指标就是为了聚焦关注度和降低理解成本的，下面我们就来具体看一下，新增加的 <code>Core Web Vitals</code> 到底是什么东西？</p>
<h2 id="toc_h2_0">如何衡量用户体验质量？</h2>
<p><img src="https://b3logfile.com/file/2020/06/6401-bf764d3e.png" alt="6401.png"></p>
<p>优化用户体验的质量一直都是是每个 <code>Web</code> 站点长期成功的关键，衡量用户体验的质量有很多方面。虽然用户体验的某些方面是需要基于特定于站点和上下文的，但是所有站点仍然有一组共同的指标——<code>Core Web Vitals</code>，这些指标包括加载体验、交互性和页面内容的视觉稳定性，他们构成了 <code>2020</code> 年核心 <code>Web</code> 健康指标的基础。</p>
<p>多年来，Google 提供了很多工具：(<code>Lighthouse, Chrome DevTools, PageSpeed Insights, Search Console's Speed Report</code>) 来衡量和报告性能。一些开发人员是使用这些工具的专家，而大部分其他人则发现大量的工具和衡量标准都很难学习和使用。</p>
<p>网站开发者不应该为了理解他们交付给用户的体验的质量指标而成为性能专家。<code>Web Vitals</code> 计划的目的就是简化场景，降低学习成本，并帮助站点关注最重要的指标，即 <code>Core Web Vitals</code>。</p>
<h2 id="toc_h2_1">Core Web Vitals</h2>
<p><code>Core Web Vitals</code> 是应用于所有 <code>Web</code> 页面的 <code>Web Vitals</code> 的子集，所有的站点开发者都应该关注一下，他们将在所有谷歌提供的性能测试工具中进行显示。每个 <code>Core Web Vitals</code> 代表用户体验的一个不同方面，在该领域是可衡量的，并反映了以用户为中心的关键结果的真实体验。</p>
<p>网页核心的性能指标应该是随着时间的推移而不断演变的。当前 <code>2020</code> 年主要关注用户体验的三个方面——加载、交互性和视觉稳定性：<br>
<img src="https://b3logfile.com/file/2020/06/6402-a05cb637.png" alt="6402.png"></p>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">Largest Contentful Paint (LCP)</code>: 衡量加载体验：为了提供良好的用户体验， <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">LCP</code> 应该在页面首次开始加载后的 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">2.5</code> 秒内发生。</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">First Input Delay (FID)</code>: 衡量可交互性，为了提供良好的用户体验，页面的 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">FID</code> 应当小于 100毫秒。</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">Cumulative Layout Shift (CLS)</code>:衡量视觉稳定性，为了提供良好的用户体验，页面的CLS应保持小于 0.1。</section>
</li>
</ul>
<p>下面我们来详细介绍这三种性能指标：</p>
<h2 id="toc_h2_2">LCP</h2>
<h3 id="toc_h3_3">加载体验的衡量</h3>
<p>衡量 <code>Web</code> 页主要内容的加载速度是众多开发者一直在关注的一个点，而且可衡量的指标非常多。</p>
<p>比如最早的 <code>load</code>、<code>DOMContentLoaded</code> 事件，用这两个事件来衡量页面加载速度是非常糟糕的，因为它们不一定与用户在屏幕上看到的内容相对应。</p>
<p>以用户为中心的更新性能指标（例如 <code>First Contentful Paint（FCP）</code>）它只能捕捉加载体验的最开始。如果页面最开始显示的是一个 <code>loading</code> 动画，那这个指标就很难关注了。</p>
<p>后来，业界开始建议使用比如 <code>First Meaningful Paint (FMP)</code> 和 <code>Speed Index (SI)</code>（都可以在 <code>Lighthouse</code> 中获取）等性能指标来帮助捕获初次渲染后的更多加载体验，但是这些指标非常复杂，难以解释，而且误报率也比较高。</p>
<h3 id="toc_h3_4">什么是 LCP</h3>
<p><img src="https://b3logfile.com/file/2020/06/6403-c1bc2333.png" alt="6403.png"><br>
<code>Largest Contentful Paint (LCP)</code> 用于衡量标准报告视口内可见的最大内容元素的渲染时间。为了提供良好的用户体验，网站应努力在开始加载页面的前 <code>2.5</code> 秒内进行 <code>最大内容渲染</code> 。</p>
<p>相比 <code>FCP</code> ，这个指标就非常有价值了，因为这个值是根据页面加载渲染不断变化的，如果页面有一个 <code>lodaing</code> 动画，然后才渲染出具体内容，那么这个指标计算出来的就是具体内容的加载速度，而非 <code>lodaing</code> 动画的加载速度。</p>
<h3 id="toc_h3_5">LCP 考虑哪些元素</h3>
<p><code>LCP</code> 目前并不会计算所有元素，因为这样会使这个指标变得非常复杂，它现在只关注下面的元素：</p>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;img&gt;</code> 元素</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;image&gt;</code>元素内的<code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;svg&gt;</code>元素</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;video&gt;</code> 元素</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">通过 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">url()</code> 函数加载背景图片的元素</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">包含文本节点或其他内联文本元素子级的块级元素。</section>
</li>
</ul>
<blockquote>
<p>为了在开始时保持简单，将元素限制到这个有限的集合是有意的。随着研究的深入，将来可能会添加更多的元素。</p>
</blockquote>
<h3 id="toc_h3_6">如何计算 LCP ?</h3>
<p>页面上最大的元素即绘制面积最大的元素，所谓绘制面积可以理解为每个元素在屏幕上的 “占地面积”，如果元素延伸到屏幕外，或者元素被裁切了一部分，被裁切的部分不算入在内，只有真正显示在屏幕里的才算数。</p>
<p>图片元素的面积计算方式稍微有点不同，因为可以通过 <code>CSS</code> 将图片扩大或缩小显示，也就是说，图片有两个面积：“渲染面积”与“真实面积”。在 <code>LCP</code> 的计算中，图片的绘制面积将获取较小的数值。例如：当“渲染面积”小于“真实面积”时，“绘制面积”为“渲染面积”，反之亦然。</p>
<p>页面在加载过程中，是线性的，元素是一个一个渲染到屏幕上的，而不是一瞬间全渲染到屏幕上，所以“渲染面积”最大的元素随时在发生变化。</p>
<p>如果元素被删除，LCP 算法将不再考虑该元素，如果被删除的元素刚好是 “绘制面积” 最大的元素，则使用新的 “绘制面积” 最大的元素创建一个新的性能条目。</p>
<p>该过程将持续到用户第一次滚动页面或第一次用户输入（鼠标点击，键盘按键等），也就是说，一旦用户与页面开始产生交互，则停止报告新的性能指标。<br>
<img src="https://b3logfile.com/file/2020/06/6404-14ec6e5d.png" alt="6404.png"><br>
在以上两个时间轴中，最大的元素随内容加载而变化。在第一个示例中，新内容被添加到 <code>DOM</code> 中，并且更改了最大的元素。在第二个示例中，布局发生更改，以前最大的内容从视口中删除。通常情况下，延迟加载的内容要大于页面上已存在的内容。</p>
<h3 id="toc_h3_7">改善 LCP</h3>
<p>LCP 较差的最常见原因是：</p>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">服务器响应时间慢</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">阻断渲染的 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">Javascript</code> 和 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">CSS</code></section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">资源加载时间慢</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">客户端渲染</section>
</li>
</ul>
<p>所以我们从上面的角度去考虑改善 <code>LCP</code>：</p>
<h4 id="toc_h4_8">优化服务器</h4>
<p>这个很好理解，浏览器从服务器接收内容所需的时间越长，则在屏幕上呈现任何内容所花费的时间就越长。更快的服务器响应时间可以直接改善包括 <code>LCP</code> 在内的所有页面加载指标。<br>
<img src="https://b3logfile.com/file/2020/06/6405-2465155f.png" alt="6405.png"><br>
衡量服务器相应时间有一个专门的指标：首字节相应时间（<code>TTFB</code>）是最初的网络请求被发起到从服务器接收到第一个字节这段时间，它包含了 <code>TCP</code> 连接时间，发送 <code>HTTP</code> 请求时间和获得响应消息第一个字节的时间。你可以尝试在下面几个方便优化 <code>TTFB</code> ：</p>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">缓存 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">HTML</code> 离线页面，缓存页面资源，减少浏览器对资源的请求。</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">尽量减小资源阻断渲染：<code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">CSS</code> 和 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">JavaScript</code> 压缩、合并、级联、内联等等</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">对图片进行优化。转化图片的格式为 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">JPG</code> 或者 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">WEBP</code> 等等的格式，降低图片的大小，以加快请求的速度。</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">对 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">HTML</code> 重写、压缩空格、去除注释等。减少 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">HTML</code> 大小，加快速度。</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">使用 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">preconnect</code> 尽快与服务器建立链接、使用 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">dns-prefetch</code> 尽快进行 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">DNS</code> 查找。</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">使用 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">CDN</code> 加快请求速度</section>
</li>
</ul>
<h4 id="toc_h4_9">优化阻断渲染的资源</h4>
<p><code>JavaScript</code> 和 <code>CSS</code> 都是会阻断页面渲染的资源，需要尽可能的对 <code>CSS</code> 和 <code>JavaScript</code> 文件进行压缩、延迟加载首屏无需使用的 <code>JavaScript</code>、内联关键的 <code>CSS</code> 等来减小阻断时间。</p>
<h4 id="toc_h4_10">优化资源加载时间</h4>
<p>刚才我们上面提到的这些资源，如果在首屏进行渲染，则加载这些元素所花费的时间将直接影响 <code>LCP</code> 。</p>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;img&gt;</code> 元素</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;image&gt;</code>元素内的<code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;svg&gt;</code>元素</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;video&gt;</code> 元素</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">通过 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">url()</code> 函数加载背景图片的元素</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">包含文本节点或其他内联文本元素子级的块级元素。</section>
</li>
</ul>
<p>你可以使用下面的手段进行优化：</p>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">对图片进行优化。转化图片的格式为 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">JPG</code> 或者 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">WEBP</code> 等等的格式，降低图片的大小。</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">对重要的资源进行预加载，比如为 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">style</code> 标签添加 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">rel="preload"</code> 属性</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">使用 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">Gzip</code> 和 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">Brotli</code> 压缩页面资源，降低传输时间</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">使用 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">service worker</code> 缓存资源</section>
</li>
</ul>
<h4 id="toc_h4_11">服务端渲染</h4>
<p>使用服务端渲染可以确保首先在服务器上呈现页面内容，可以有效改善 <code>LCP</code>，但是相比客户端渲染的缺点是会加大页面从而影响 <code>TTFB</code>、服务端渲染需要等待所有 js 执行完毕后才能相应用户输入，这会使交互体验变差。</p>
<h2 id="toc_h2_12">FID</h2>
<h3 id="toc_h3_13">第一印象</h3>
<p>我们都知道留下一个好的第一印象是多么重要。在网络上，一个好的第一印象可以决定一个人是不是可以成为一个网站的忠实的用户，或者是离开以后再也不会回来。问题是，什么能给人留下好印象，你如何衡量你可能给用户留下什么样的印象？</p>
<p>在网络上，第一印象可以有很多种不同的形式——我们对网站的设计和视觉吸引力有第一印象，对其速度和响应能力也有第一印象。</p>
<p>开发者们使用 <code>First Contentful Paint（FCP）</code> 可以衡量对网站加载速度对第一印象 。但是，网站可以在屏幕上绘制像素的速度只是一部分，同样重要的是用户尝试与这些像素进行交互时你的网站的响应速度！</p>
<h3 id="toc_h3_14">什么是 FID</h3>
<p><img src="https://b3logfile.com/file/2020/06/6406-2321343f.png" alt="6406.png"><br>
<code>FID（ First Input Delay）</code> 即记录用户和页面进行首次交互操作所花费的时间 <code>。FID</code> 指标影响用户对页面交互性和响应性的第一印象。为了提供良好的用户体验，站点应努力使首次输入延迟小于 <code>100</code> 毫秒。</p>
<p><code>FID</code> 发生在 <code>FCP</code> 和 <code>TTI</code> 之间，因为这个阶段虽然页面已经显示出部分内容，但尚不具备完全的可交互性。这个阶段用户和页面交互，往往会有较大延迟。<br>
<img src="https://b3logfile.com/file/2020/06/6407-4bd1e16d.png" alt="6407.png"><br>
如上图所示，浏览器接收到用户输入操作时，主线程正在忙于执行一个耗时比较长的任务，只有当这个任务执行完成后，浏览器才能响应用户的输入操作。它必须等待的时间就此页面上该用户的 <code>FID</code> 值。</p>
<p>例如，以下所有 <code>HTML</code> 元素都需要在响应用户交互之前等待主线程上正在进行的任务完成：</p>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">文本输入框，复选框和单选按钮（<code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;input&gt;，&lt;textarea&gt;</code>）</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">选择下拉菜单（<code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;select&gt;</code>）</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">链接（<code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">&lt;a&gt;</code>）</section>
</li>
</ul>
<h3 id="toc_h3_15">如何提高 FID</h3>
<p>以下几个方面是提高 <code>FID</code> 的重要指标：</p>
<h4 id="toc_h4_16">减少 <code>JavaScript</code> 执行时间</h4>
<p>同上面改善 <code>LCP</code> 的方法：</p>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">缩小并压缩 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">JavaScript</code> 文件</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">延迟加载首屏不需要的 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">JavaScript</code></section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">尽量减少未使用的 <code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">polyfill</code></section>
</li>
</ul>
<h4 id="toc_h4_17">分解耗时任务</h4>
<p><img src="https://b3logfile.com/file/2020/06/6408-63cc86bc.png" alt="6408.png"><br>
上面提到一个较长的耗时任务是影响 <code>FID</code> 的重要指标，任何阻塞主线程 <code>50</code> 毫秒或更长时间的代码段都可以称为“长任务”，我们可以将长的耗时任务拆分为较小的异步任务。</p>
<h4 id="toc_h4_18">使用 Web Worker</h4>
<p><img src="https://b3logfile.com/file/2020/06/6409-24f933a2.png" alt="6409.png"><br>
主线程阻塞是输入延迟的主要原因之一。<code>Web Workers</code> 可以让你在与主执行线程分离的后台线程上运行 <code>JavaScript</code>，这样做的好处是可以在一个单独的线程中执行费时的处理任务，从而允许主（通常是 UI）线程运行而不被阻塞。将非 <code>UI</code> 操作移至单独的工作线程可以减少主线程的阻塞时间，从而改善 <code>FID</code> 。</p>
<h2 id="toc_h2_19">CLS</h2>
<h3 id="toc_h3_20">视觉稳定性</h3>
<p><img src="https://b3logfile.com/file/2020/06/64010-54db9178.png" alt="64010.png"></p>
<p>您是否曾经在访问一个 <code>Web</code> 页面时发生下面的情况？在阅读文章的同时文字突然移动了、你突然找不到你阅读的位置了、点按钮的时候按钮被移动到了其他地方，导致你点了其他东西？</p>
<p>页面内容的意外移动通常是由于异步加载资源或将 <code>DOM</code> 元素动态添加到现有内容上方的页面而发生的。罪魁祸首可能是尺寸未知的图像或视频，渲染后比其后备更大或更小的字体，或者是动态调整自身大小的第三方广告或小部件。</p>
<p><code>Cumulative Layout Shift (CLS)</code> 可通过测量实际用户发生的频率来帮助您解决此问题。</p>
<h3 id="toc_h3_21">什么是 CLS？</h3>
<p><img src="https://b3logfile.com/file/2020/06/64011-cc694db2.png" alt="64011.png"><br>
<code>CLS</code> 会测量在页面的整个生命周期中发生的每个意外的样式移动的所有单独布局更改得分的总和。布局的移动可能发生在可见元素从一帧到下一帧改变位置的任何时候。为了提供良好的用户体验，网站应努力使 <code>CLS</code> 分数小于 <code>0.1</code> 。</p>
<h3 id="toc_h3_22">如何计算 CLS?</h3>
<p><strong>布局偏移分值</strong></p>
<p>为了计算布局的偏移值，浏览器会查看两个渲染帧之间的视口大小和视口中不稳定元素的移动。布局偏移分是该移动的两个指标的乘积：影响分数和距离分数。</p>
<pre><code>layout shift score = impact fraction * distance fraction
</code></pre>
<p><strong>影响分数</strong></p>
<p>前一帧和当前帧的所有不稳定元素的可见区域的并集（占视口总面积的一部分）是当前帧的影响分数。<br>
<img src="https://b3logfile.com/file/2020/06/64012-85334281.png" alt="64012.png"><br>
在上图中，有一个元素在一帧中占据了视口的一半。然后，在下一帧中，元素下移视口高度的 <code>25％</code>。红色的虚线矩形表示两个帧中元素的可见区域的并集，在这种情况下，其为总视口的 <code>75％</code>，因此其影响分数为 <code>0.75</code>。</p>
<p><strong>距离分数</strong></p>
<p>布局偏移值方程的另一部分测量不稳定元素相对于视口移动的距离。距离分数是任何不稳定元素在框架中移动的最大距离(水平或垂直)除以视口的最大尺寸(宽度或高度，以较大的为准)。<br>
<img src="https://b3logfile.com/file/2020/06/64013-71b45891.png" alt="64013.png"><br>
在上面的例子中，最大的视口尺寸是高度，并且不稳定元素移动了视口高度的 <code>25%</code>，这使得距离分数为 <code>0.25</code>。</p>
<p>因此，在此示例中，影响分数为 <code>0.75</code>，距离分数为 <code>0.25</code>，因此版式位移分数为 <code>0.75 * 0.25 = 0.1875</code>。</p>
<h3 id="toc_h3_23">如何改善 CLS?</h3>
<h4 id="toc_h4_24">不要使用无尺寸元素</h4>
<p>图像和视频等元素上始终需要包括 <code>width</code> 和 <code>height</code> 尺寸属性，现代浏览器会根据图像的 <code>width</code> 和 <code>height</code> 属性设置图像的默认长宽比，知道纵横比后，浏览器就可以为元素计算和保留足够的空间。</p>
<p>或者，使用 <code>aspect-ratio</code> 也可以提前指定宽高比：</p>
<pre><code>img {
    aspect-ratio: attr(width) / attr(height);
}
</code></pre>
<p>那响应式的图片呢？可以使用 <code>srcset</code> 定义图像，使浏览器可以在图像之间进行选择，以及每个图像的大小。</p>
<pre><code>&lt;img 
    width="1000" 
    height="1000"
    src="puppy-1000.jpg"
    srcset="puppy-1000.jpg 1000w,
            puppy-2000.jpg 2000w,
            puppy-3000.jpg 3000w"
    alt="ConardLi"
/&gt;
</code></pre>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">永远不要在现有内容之上插入内容，除非是响应用户交互。这确保了预期的布局变化。</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);">宁可转换动画，也不要转换触发布局变化的属性的动画。以一种提供从一个状态到另一个状态的上下文和连续性的方式动画转换。</section>
</li>
</ul>
<h4 id="toc_h4_25">提前给广告位预留空间</h4>
<p>很多页面广告都是动态插入的，所以一定要提前为广告位预留一定空间。</p>
<h4 id="toc_h4_26">警惕字体变化</h4>
<p>字体通常是大文件，需要一段时间才能加载，一些浏览器直到下载完字体后才呈现文本</p>
<p><code>font-display: swap</code> 告诉浏览器默认使用系统字体进行渲染，当自定义字体下载完成之后再进行替换。</p>
<pre><code>@font-face {
  font-family: 'Pacifico';
  font-style: normal;
  font-weight: 400;
  src: local('Pacifico Regular'), local('Pacifico-Regular'), url(https://fonts.gstatic.com/xxx.woff2) format('woff2');
  font-display: swap;
}
</code></pre>
<p>另外，你可以使用 <code>&lt;link rel="preload"&gt;</code> 更早的加载字体文件。</p>
<h2 id="toc_h2_27">获取 Core Web Vitals</h2>
<p>Google 认为，<code>Core Web Vitals</code> 对于所有网络体验都至关重要。因此，它致力于在其工具中显示这些指标，下面是现有工具中指标的支持情况：<br>
<img src="https://b3logfile.com/file/2020/06/64014-2e6829d7.png" alt="64014.png"></p>
<blockquote>
<p>尚未支持这些指标的工具都将在最近得到支持。</p>
</blockquote>
<h3 id="toc_h3_28">web-vitals</h3>
<p><img src="https://b3logfile.com/file/2020/06/64015-2993097e.png" alt="64015.png"></p>
<p>现在你可以使用标准的 <code>Web API</code> 在 <code>JavaScript</code> 中测量每个指标。<code>Google</code> 提供了一个 <code>npm</code> 包：<code>web-vitals</code>，这个库提供了非常简单的 <code>API</code>，测量每个指标就像调用一个普通函数一样简单：</p>
<pre><code>npm install web-vitals
</code></pre>
<p>每个测量函数都接收一个 <code>report</code> 回调函数作为参数，回调函数将在测量完成后触发，另外，对于像 <code>LCP</code> 和 <code>CLS</code> 这样的指标是不断变化的，所以它们的回调函数可能会多次触发，如果你想获取在这期间获取每次变化的数值，你可以指定第二个参数 <code>reportAllChanges</code>，否则回调函数只有在最终测量完成后触发一次。</p>
<pre><code>import {getCLS, getFID, getLCP} from 'web-vitals';

getCLS(console.log, true);
getFID(console.log); // Does not take a `reportAllChanges` param.
getLCP(console.log, true);
</code></pre>
<p>这些变化的指标如果触发多次的话可能会多次发送到你的服务器，所以回调函数中提供了下面三个参数：</p>
<ul>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">name</code>：指标名称</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">id</code>：本地分析的id</section>
</li>
<li>
<section style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 26px; color: rgb(1, 1, 1);"><code style="margin: 0px 2px; padding: 2px 4px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word; font-size: 14px; border-radius: 4px; background-color: rgba(27, 31, 35, 0.05); font-family: " operator mono", consolas, monaco, menlo, monospace; word-break: break-all; color: rgb(150, 84, 181);">delta</code>：当前值和上次获取值的差值</section>
</li>
</ul>
<p>因此你只需要每次上报 <code>delta</code> (当前值和上次获取值的差值)，而不需要报告新值。然后在服务器可以通过计算所有 id 对应值的和来获取最终结果。<br>
<img src="https://b3logfile.com/file/2020/06/64016-eea8d925.png" alt="64016.png"></p>
<pre><code>import {getCLS, getFID, getLCP} from 'web-vitals';

function logDelta({name, id, delta}) {
  console.log(`${name} matching ID ${id} changed by ${delta}`);
}

getCLS(logDelta, true);
getFID(logDelta);
getLCP(logDelta, true);
</code></pre>
<h2 id="toc_h2_29">小结</h2>
<p>最后，想在浏览器中使用上面的工具和指标？快升级一下 <code>Chrome 83</code> 版本吧 ～，更多 <code>Chrome 83</code> 的更新可以点击 <a href="https://mp.weixin.qq.com/s?__biz=Mzg2NDAzMjE5NQ==&amp;mid=2247485716&amp;idx=1&amp;sn=cb8ecf78cd25666e7baadd358ce6f8d6&amp;scene=21#wechat_redirect" target="_blank">Chrome 83 发布，支持直接读写本地文件！新的跨域策略!</a> 查看。</p>
                        <div>
                            <hr>

标题：新一代 Web 性能体验和质量指标及其提升方法<br>
作者：<a href="https://ymfed.github.io" target="_blank">Steven201612</a><br>
地址：<a href="https://ymfed.github.io/articles/2020/06/01/1591001620265.html" target="_blank">https://ymfed.github.io/articles/2020/06/01/1591001620265.html</a><br>

<!-- 签名档内可使用 HTML、JavaScript -->
<br>
                        </div>
                </div>

                <footer class="tags">
                        <a class="tag" rel="tag" href="https://ymfed.github.io/tags/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">
                            前端性能优化</a>
                        <a class="tag" rel="tag" href="https://ymfed.github.io/tags/JS">
                            JS</a>

                    <div class="rel fn-clear ft__center">
                            <a href="https://ymfed.github.io/articles/2020/05/29/1590745984415.html" rel="prev"
                               class="fn-left vditor-tooltipped vditor-tooltipped__n"
                               aria-label="ECMAScript 2020新特性">
                                旧一篇
                            </a>
                            <a href="https://ymfed.github.io/articles/2020/06/01/1591015157950.html" rel="next"
                               class="fn-right vditor-tooltipped vditor-tooltipped__n"
                               aria-label="BFC知识总结">
                                新一篇
                            </a>
                    </div>
                </footer>
                    <div id="b3logsolocomments"></div>
                    <div id="vcomment" data-name="Steven201612" data-postId="1591001620265"></div>
                <br>
                <div id="externalRelevantArticles" class="list"></div>
                <div id="relevantArticles" class="list"></div>
                <div id="randomArticles" class="list"></div>
            </article>
        </main>
<aside>
<ul class="article__toc">
        <li class="toc__h2">
            <a href="#toc_h2_0">如何衡量用户体验质量？</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_1">Core Web Vitals</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_2">LCP</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_3">加载体验的衡量</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_4">什么是 LCP</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_5">LCP 考虑哪些元素</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_6">如何计算 LCP ?</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_7">改善 LCP</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_8">优化服务器</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_9">优化阻断渲染的资源</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_10">优化资源加载时间</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_11">服务端渲染</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_12">FID</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_13">第一印象</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_14">什么是 FID</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_15">如何提高 FID</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_16">减少 JavaScript 执行时间</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_17">分解耗时任务</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_18">使用 Web Worker</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_19">CLS</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_20">视觉稳定性</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_21">什么是 CLS？</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_22">如何计算 CLS?</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_23">如何改善 CLS?</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_24">不要使用无尺寸元素</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_25">提前给广告位预留空间</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_26">警惕字体变化</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_27">获取 Core Web Vitals</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_28">web-vitals</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_29">小结</a>
        </li>
</ul></aside>
    </div>
</div>
<footer class="footer fn-clear">
    &copy; 2020
    <a href="https://ymfed.github.io">亚美大前端（FED）</a>
    
    <br/>
    Powered by <a href="https://solo.b3log.org" target="_blank">YMFED</a>
    <span class="ft-warn">&heartsuit;</span>
    Theme
    <sup>[<a href="javascript:;" target="_blank">ref</a>]</sup>
    by <a href="javascript:;" target="_blank">亚美Web团队</a>
</footer>
<div class="icon-up" onclick="Util.goTop()"></div>
<script>
  var Label = {
    servePath: "https://ymfed.github.io",
    staticServePath: "https://ymfed.github.io",
    luteAvailable: false,
    hljsStyle: 'github',
    langLabel: "zh_CN",
    version: "3.9.0",
    staticSite: true,
    showCodeBlockLn: false,
  }
</script>
<script src="https://ymfed.github.io/skins/9IPHP/js/common.min.js?1585645466987"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.6/index.css"/>
<script async src="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.6/index.js"></script>
<div class="solo-kanbanniang">
    <div class="solo-kanbanniang__tip"></div>
    <canvas id="soloKanbanniang" width="280" height="250"></canvas>
    <div class="solo-kanbanniang__tool">
        <svg id="soloKanbanniangHome" viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32 18.967l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18.516v12h-8v-8h-8v8h-8v-12l12-9z"></path>
        </svg>
        <svg id="soloKanbanniangRSS" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M320.364 768q0 45.728-32 77.728t-77.728 32-77.728-32-32-77.728 32-77.728 77.728-32 77.728 32 32 77.728zM612.94 838.272q1.152 16-9.728 27.424-10.272 12-26.848 12h-77.152q-14.272 0-24.576-9.44t-11.424-23.712q-12.576-130.848-105.44-223.712t-223.712-105.44q-14.272-1.152-23.712-11.424t-9.44-24.576V402.24q0-16.576 12-26.848 9.728-9.728 24.576-9.728h2.848q91.424 7.424 174.848 46.016t148 103.712q65.152 64.576 103.712 148t46.016 174.848z m292.576 1.152q1.152 15.424-10.272 26.848-10.272 11.424-26.272 11.424h-81.728q-14.848 0-25.44-10.016t-11.136-24.288q-6.848-122.848-57.728-233.44t-132.288-192-192-132.288-233.44-58.272q-14.272-0.576-24.288-11.136t-10.016-24.864V109.664q0-16 11.424-26.272 10.272-10.272 25.152-10.272h1.728q149.728 7.424 286.56 68.576t243.136 168q106.848 106.272 168 243.136t68.576 286.56z"></path>
        </svg>
        <svg id="soloKanbanniangChat" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M802.42709 96.163153H219.476155c-84.48109 0-154.896836 71.746044-154.896836 157.840888v393.119449c0 86.072331 70.415746 157.819398 154.896836 157.819399h214.038818V925.470963s22.526039 40.168862 64.767096 5.734608c30.965246-25.819039 126.721123-91.828428 171.775248-123.385145h132.369773c84.502579 0 154.896836-83.21526 154.896836-157.839865V251.125481c0-86.094844-70.394257-154.962328-154.896836-154.962328zM301.144176 518.002714c-39.427988 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044 39.426965 0 70.393233 31.577183 70.393234 71.746044 0 40.169885-30.966269 71.746044-70.393234 71.746044z m208.411657 0c-39.450501 0-70.415746-31.576159-70.415746-71.746044 0-40.168862 30.965246-71.746044 70.415746-71.746044 39.405475 0 70.394257 31.577183 70.394257 71.746044 0 40.169885-30.988782 71.746044-70.394257 71.746044z m211.203236 0c-39.426965 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044s70.415746 31.577183 70.415746 71.746044c-0.001023 40.169885-30.988782 71.746044-70.415746 71.746044z"></path>
        </svg>
        <svg id="soloKanbanniangChange" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M936.672 193.216l-226.88-64c-8.704-2.528-18.112-1.12-25.824 3.776-7.68 4.864-12.896 12.736-14.432 21.728C655.712 236.928 595.328 288 512 288c-71.424 0-142.464-103.296-163.776-143.104-7.136-13.28-22.528-19.84-37.024-15.68l-224 64C73.472 197.152 64 209.728 64 224v256a31.93 31.93 0 0 0 11.712 24.736c7.392 6.08 17.152 8.512 26.56 6.624L224 487.04V832c0 52.928 43.072 96 96 96h384c52.928 0 96-43.072 96-96V519.04l121.728 24.352c9.44 1.92 19.2-0.544 26.56-6.624C955.68 530.656 960 521.6 960 512V224c0-14.336-9.536-26.912-23.328-30.784zM672 800H352c-17.664 0-32-14.304-32-32s14.336-32 32-32h320c17.696 0 32 14.304 32 32s-14.304 32-32 32z"></path>
        </svg>
        <svg id="soloKanbanniangPhoto" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M898.048 258.048q23.552-1.024 46.592 9.216t40.96 27.136 28.672 39.424 10.752 46.08l0 390.144q0 24.576-10.752 47.104t-28.672 40.448-40.96 28.16-47.616 10.24l-697.344 0q-24.576 0-48.64-10.24t-42.496-27.648-29.696-40.448-11.264-48.64l0-381.952q0-22.528 10.752-45.568t28.672-41.472 39.936-30.208 44.544-11.776l63.488 0 13.312-83.968q3.072-20.48 18.432-32.768t34.816-12.288l456.704 0q19.456 0 34.304 10.752t16.896 34.304l14.336 83.968 54.272 0zM548.864 712.704q40.96 0 77.824-15.872t63.488-42.496 42.496-62.976 15.872-77.312-15.872-77.312-42.496-62.976-63.488-42.496-77.824-15.872-77.312 15.872-63.488 42.496-43.008 62.976-15.872 77.312 15.872 77.312 43.008 62.976 63.488 42.496 77.312 15.872z"></path>
        </svg>
        <svg id="soloKanbanniangGithub" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M1024 524.8c0 114.346667-32.554667 217.216-97.706667 308.565333-65.066667 91.306667-149.162667 154.538667-252.288 189.610667-11.989333 2.304-20.778667 0.682667-26.325333-4.778667a27.605333 27.605333 0 0 1-8.362667-20.48v-144.213333c0-44.16-11.52-76.501333-34.645333-97.024 25.344-2.730667 48.085333-6.826667 68.309333-12.288a268.629333 268.629333 0 0 0 62.72-26.666667 187.434667 187.434667 0 0 0 53.973334-45.44c14.421333-18.005333 26.197333-41.898667 35.328-71.765333 9.088-29.824 13.653333-64.128 13.653333-102.826667 0-55.125333-17.536-102.058667-52.650667-140.8 16.426667-41.429333 14.677333-87.893333-5.333333-139.392-12.458667-4.096-30.464-1.578667-54.016 7.509334a355.328 355.328 0 0 0-61.312 30.08L640 271.274667a462.336 462.336 0 0 0-128-17.749334c-43.989333 0-86.656 5.930667-128 17.749334a589.824 589.824 0 0 0-28.330667-18.432c-11.776-7.253333-30.336-16.042667-55.68-26.325334-25.344-10.24-44.416-13.312-57.301333-9.216-19.584 51.498667-21.12 97.962667-4.693333 139.434667-35.114667 38.698667-52.650667 85.632-52.650667 140.757333 0 38.698667 4.565333 72.874667 13.653333 102.485334 9.130667 29.610667 20.778667 53.546667 34.986667 71.765333 14.250667 18.218667 32.128 33.493333 53.674667 45.781333 21.546667 12.288 42.453333 21.205333 62.677333 26.666667 20.224 5.461333 43.008 9.557333 68.309333 12.288-17.749333 16.384-28.629333 39.850667-32.64 70.4a130.005333 130.005333 0 0 1-29.994666 10.24c-10.666667 2.261333-23.338667 3.413333-37.973334 3.413333-14.72 0-29.269333-4.906667-43.690666-14.677333-14.464-9.813333-26.794667-24.064-36.992-42.709333a109.226667 109.226667 0 0 0-32.341334-35.541334c-13.141333-9.130667-24.106667-14.592-33.024-16.426666l-13.312-2.048c-9.344 0-15.786667 1.024-19.328 3.072-3.584 2.090667-4.693333 4.693333-3.328 7.893333 1.28 3.157333 3.328 6.4 5.973334 9.557333 2.688 3.2 5.546667 5.930667 8.661333 8.192l4.693333 3.413334c9.770667 4.565333 19.413333 13.226667 29.013334 25.984 9.514667 12.757333 16.512 24.362667 20.992 34.858666l6.656 15.701334c5.76 17.322667 15.530667 31.317333 29.312 42.026666 13.781333 10.666667 28.672 17.536 44.672 20.48 16 2.986667 31.445333 4.565333 46.336 4.821334 14.890667 0.213333 27.221333-0.597333 36.992-2.389334l15.36-2.730666c0 17.28 0.085333 37.546667 0.298666 60.8l0.341334 36.906666a27.050667 27.050667 0 0 1-8.661334 20.48c-5.76 5.461333-14.677333 7.082667-26.666666 4.778667-103.125333-35.072-187.221333-98.261333-252.330667-189.610667C32.554667 742.058667 0 639.146667 0 524.8c0-95.232 22.869333-183.04 68.693333-263.466667A516.266667 516.266667 0 0 1 254.976 70.4C333.44 23.466667 419.114667 0 512 0c92.885333 0 178.56 23.466667 256.981333 70.4a516.266667 516.266667 0 0 1 186.368 190.976C1001.130667 341.802667 1024 429.653333 1024 524.842667z"></path>
        </svg>
        <svg id="soloKanbanniangClose" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M517.572566143763 1018.6748601482986C238.26554897656422 1018.6748601482986 11.897910175114305 792.2714997690043 11.897910175114305 513.0002041796496c0-279.3070171671984 226.36763880144977-505.71037754649296 505.6746559686481-505.71037754649296 279.2712955893538 0 505.6746559686481 226.40336037929444 505.6746559686481 505.71037754649296C1023.2472221124112 792.2714997690043 796.8795833109612 1018.6748601482986 517.572566143763 1018.6748601482986zM754.7281214542927 339.25044954334646c13.752807470184345-13.752807470184345 9.680547595895998-40.186775075214015-9.073280772537204-58.94060344364717l-2.143294670678079-2.1075730928334457c-18.7538283684332-18.7538283684332-45.15207439561819-22.861809820566194-58.90488186580257-9.073280772537204l-168.21291007038468 168.24863164822932-180.42968969324974-180.46541127109438c-13.967136937252159-13.967136937252159-40.72259874288353-9.823433907274534-59.72647815622916 9.216167083915742l-2.143294670678079 2.143294670678079c-19.039600991190277 19.003879413345654-23.111860865478626 45.75934121897699-9.180445506071107 59.655035000539876l180.42968969324974 180.46541127109438-176.07165719620428 176.03593561835962c-13.788529048028984 13.824250625873615-9.716269173740633 40.151053497369375 9.073280772537204 58.94060344364717l2.1075730928334457 2.1075730928334457c18.7538283684332 18.7538283684332 45.15207439561819 22.897531398410823 58.90488186580257 9.073280772537204l176.10737877404887-176.10737877404887 170.39192631890742 170.42764789675192c13.967136937252159 13.931415359407513 40.686877165038865 9.85915548511917 59.690756578384516-9.180445506071107l2.1790162485227142-2.1790162485227142c19.039600991190277-18.968157835501014 23.147582443323273-45.72361964113239 9.180445506071107-59.690756578384516l-170.39192631890742-170.42764789675192L754.7281214542927 339.25044954334646z"></path>
        </svg>
    </div>
</div>

<script type="text/javascript">
    Util.addScript('https://ymfed.github.io/js/page.min.js?1585645466987', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论内容只能为 2 到 500 个字符！",
        "oId": "1591001620265",
        "blogHost": "https://ymfed.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "0";
    Skin.initToc()
    page.share()
    });
</script>
</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 35ms, 2020/06/24 15:11:33 -->