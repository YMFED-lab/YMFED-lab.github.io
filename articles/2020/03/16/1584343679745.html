<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>【译】用纯JavaScript写一个简单的MVC App - 亚美大前端（FED）</title><meta name="description" content="纯 JavaScript 实现 todo list app，了解 MVC 模式"/><meta property="og:description" content="纯 JavaScript 实现 todo list app，了解 MVC 模式"/>    <meta name="keywords" content="YM,亚美,前端,博客"/><link rel="dns-prefetch" href="https://ymfed.github.io"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://ymfed.github.io"><link rel="icon" type="image/png" href="http://fed.ym/images/czh-fed-logo.png"/><link rel="apple-touch-icon" href="http://fed.ym/images/czh-fed-logo.png"><link rel="shortcut icon" type="image/x-icon" href="http://fed.ym/images/czh-fed-logo.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="【译】用纯JavaScript写一个简单的MVC App - 亚美大前端（FED）"/><meta property="og:site_name" content="亚美大前端（FED）"/><meta property="og:url"      content="https://ymfed.github.io/articles/2020/03/16/1584343679745.html?"/><meta property="og:image" content="http://fed.ym/images/czh-fed-logo.png"/><link rel="search" type="application/opensearchdescription+xml" title="【译】用纯JavaScript写一个简单的MVC App - 亚美大前端（FED）" href="/opensearch.xml"><link href="https://ymfed.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://ymfed.github.io/manifest.json">        <link rel="canonical" href="https://ymfed.github.io/articles/2020/03/16/1584343679745.html">        <link rel="stylesheet"
              href="https://ymfed.github.io/skins/9IPHP/css/base.css?1585645466987"/>
            <link rel="prev" title="谈谈js的防抖和节流" href="https://ymfed.github.io/articles/2020/02/27/1582784640439.html">
            <link rel="next" title="WebSocket的简单教程" href="https://ymfed.github.io/articles/2020/03/20/1584706077495.html">
    </head>
<body>
<header>
    <div class="banner">
        <div class="fn-clear wrapper">
            <a href="https://ymfed.github.io" class="logo" rel="start"></a>
            <h2 class="subtitle-wrap">
                <p class="subtitle">亚美大前端（FED）</p>
                <p class="description">既要埋头干事，也要抬头看路</p>
            </h2>
            <div class="fn-right">
                    <a class="fn__flex-inline" href="https://ymfed.github.io/start">
                        <i class="icon-login"></i>&nbsp;开始使用
                    </a>
            </div>
        </div>
    </div>

    <div class="navbar">
        <div class="fn-clear wrapper">
            <nav class="fn-left">
                <a href="https://ymfed.github.io">
                    <i class="icon-home"></i>
                    首页
                </a>
                <a href="https://ymfed.github.io/tags.html" rel="section">
                    <i class="icon-tags"></i> 标签墙
                </a>
                <a href="https://ymfed.github.io/archives.html">
                    <i class="icon-inbox"></i> 存档
                </a>
                <a rel="archive" href="https://ymfed.github.io/links.html">
                    <i class="icon-link"></i> 友情链接
                </a>
                <a rel="archive" href="https://ymfed.github.io/team.html">
                    <i class="icon-category"></i> 团队介绍
                </a>
                <a rel="archive" href="https://ymfed.github.io/join.html">
                    <i class="icon-register"></i> 加入我们
                </a>
            </nav>
            <div class="fn-right">
                <form class="form" action="https://ymfed.github.io/search">
                    <input placeholder="搜索" id="search" type="text" name="keyword"/>
                    <button type="submit"><i class="icon-search"></i></button>
                </form>
            </div>
        </div>
    </div>
</header>
<div class="responsive fn-none">
    <i class="icon-list"></i>
    <ul class="list">
                <li>
                    <a href="https://ymfed.github.io/start">
                        <i class="icon-login"></i> 开始使用
                    </a>
                </li>
        <li>
            <a href="https://ymfed.github.io">
                <i class="icon-home"></i>
                首页
            </a>
        </li>
        <li>
            <a href="https://ymfed.github.io/tags.html" rel="section">
                <i class="icon-tags"></i> 标签墙
            </a>
        </li>
        <li>
            <a href="https://ymfed.github.io/archives.html">
                <i class="icon-inbox"></i> 存档
            </a>
        </li>
        <li>
            <a rel="archive" href="https://ymfed.github.io/links.html">
                <i class="icon-link"></i> 友情链接
            </a>
        </li>
        <li>
            <a rel="archive" href="https://ymfed.github.io/team.html">
                <i class="icon-category"></i> 团队介绍
            </a>
        </li>
        <li>
            <a rel="archive" href="https://ymfed.github.io/join.html">
                <i class="icon-register"></i> 加入我们
            </a>
        </li>
    </ul>
</div><div class="wrapper">
    <div class="main-wrap">
        <main>
            <article class="post">
                <header>
                    <h2>
                        <a rel="bookmark" href="https://ymfed.github.io/articles/2020/03/16/1584343679745.html">
                            【译】用纯JavaScript写一个简单的MVC App
                        </a>
                    </h2>
                    <div class="meta">
                                <span class="vditor-tooltipped vditor-tooltipped__n"
                                      aria-label="更新日期">
                                    <i class="icon-date"></i>
                                    <time>
                                    2020-03-16
                                    </time>
                                </span>
                        &nbsp; | &nbsp;
                        <span class="vditor-tooltipped vditor-tooltipped__n" aria-label="评论数">
                                    <i class="icon-comments"></i>
                                    <a href="https://ymfed.github.io/articles/2020/03/16/1584343679745.html#b3logsolocomments">
                                        <span data-uvstatcmt="1584343679745">0</span> 评论</a>
                                </span>
                        &nbsp; | &nbsp;
                        <span class="vditor-tooltipped vditor-tooltipped__n" aria-label="浏览数">
                                    <i class="icon-views"></i>
                        <span data-uvstaturl="https://ymfed.github.io/articles/2020/03/16/1584343679745.html">0</span> 浏览
                                </span>
                    </div>
                </header>

                <div class="vditor-reset post__content">
                    <p>我想使用 <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank">model-view-controller</a> 体系结构模式并用纯 <code>JavaScript</code> 编写一个简单的应用程序。所以我着手做了，下面就是。希望能帮你理解 MVC，因为这是一个很难理解的概念，刚接触时候会很疑惑。</p>
<p>我制作了 <a href="https://taniarascia.github.io/mvc" target="_blank">this todo app</a>，它是一个简单的浏览器小应用程序，你可以进行 CRUD（create, read, update, delete）操作。它仅由 <code>index.html</code>,<code>style.less</code> 和 <code>script.js</code> 文件组成，非常棒而且简单，无需安装依赖/无需框架就可以学习。</p>
<h3 id="toc_h3_0">前置条件</h3>
<ul>
<li>基本的 <code>JavaScript</code> 和 <code>HTML</code> 知识</li>
<li>熟悉 <a href="https://www.taniarascia.com/es6-syntax-and-feature-overview/" target="_blank">the latest JavaScript syntax</a></li>
</ul>
<h3 id="toc_h3_1">目标</h3>
<p>用纯 <code>JavaScript</code> 在浏览器中创建一个待办事项程序(a todo app)，并且熟悉 <code>MVC</code> 概念（和 OOP-object-oriented programming，面向对象编程）。</p>
<ul>
<li><a href="https://taniarascia.github.io/mvc" target="_blank">View demo</a></li>
<li><a href="https://github.com/taniarascia/mvc" target="_blank">View source</a></li>
</ul>
<blockquote>
<p>因为这个程序使用了最新的 <code>JavaScript</code> 特性（ES2017），在不使用 <code>Babel</code> 编译为向后兼容的 <code>JavaScript</code> 语法的情况下，在 <code>Safari</code> 这样的浏览器上无法按照预期工作。</p>
</blockquote>
<h3 id="toc_h3_2">什么是 MVC?</h3>
<p><code>MVC</code> 是组织代码的一种模式。它是受欢迎的模式之一。</p>
<ul>
<li>Model - 管理应用程序的数据</li>
<li>View - Model 的可视化表示（也就是视图）</li>
<li>Controller - 连接用户和系统</li>
</ul>
<p><strong>model</strong> 就是数据。在此代办事项应用程序中，这将是实际的待办事项，以及将会添加、编辑和删除它们的方法。</p>
<p><strong>view</strong> 是数据的显示方式。在此代办事项应用程序中，这将是 <code>DOM</code> 和 <code>CSS</code> 呈现出来的 <code>HTML</code>。</p>
<p><strong>controller</strong> 连接 <strong>model</strong> 和 <strong>view</strong>。它接受用户输入，比如单击或者键入，并处理用户交互的回调。</p>
<p><strong>model</strong> 永远不会触及 <strong>view</strong>。<strong>view</strong> 永远不会触及 <strong>model</strong>。<strong>controller</strong> 将它们连接起来。</p>
<blockquote>
<p>我想说的是，在这个简单的 todo app 中使用 MVC 大才小用。如果这是你要创建的应用程序，并且整个系统都由你自己开发，那确实会使得事情变得过于复杂。重点是尝试从一个较小的角度了解它，以便你可以理解为什么一个可伸缩迭代的系统会使用它。</p>
</blockquote>
<h3 id="toc_h3_3">初始化设置</h3>
<p>这将是一个完全的 <code>JavaScript</code> 的应用程序，这就意味着所有的内容将通过 <code>JavaScript</code> 处理，而 <code>HTML</code> 在主体中仅包含一个根元素。</p>
<pre><code class="language-html">&lt;!--index.html--&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge" /&gt;

    &lt;title&gt;Todo App&lt;/title&gt;

    &lt;link rel="stylesheet" href="style.css" /&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;

    &lt;script src="script.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>我写了些 <code>CSS</code> 让它看起来更加可被接受，你可以通过<a href="https://github.com/taniarascia/mvc/blob/master/style.css" target="_blank">连接</a>找到它，并且放在 <code>style.css</code> 中保存。我不会再写更多关于 <code>CSS</code> 的东西，因为它不是本文的焦点。</p>
<p>好了，现在我们有了 <code>HTML</code> 和 <code>CSS</code>，所以是时候开始写这个应用程序了。</p>
<h3 id="toc_h3_4">开始</h3>
<p>我们将使它变得非常好用和简单，以了解哪些类对应 <code>MVC</code> 的哪部分。</p>
<p>我将创建一个 <code>Model</code> 类，一个 <code>View</code> 类和一个 <code>Controller</code> 类，它们将包含 <strong>model</strong> 和 <strong>view</strong>。该应用是控制器的一个实例。</p>
<blockquote>
<p>如果你不熟悉类是怎么工作的，先去读下 <a href="https://www.taniarascia.com/understanding-classes-in-javascript/" target="_blank">Understanding Classes in JavaScript</a> 文章</p>
</blockquote>
<pre><code class="language-javascript">class Model {
  constructor() {}
}

class View {
  constructor() {}
}

class Controller {
  constructor(model, view) {
    this.model = model
    this.view = view
  }
}

const app = new Controller(new Model(), new View())
</code></pre>
<p>非常棒，而且抽象。</p>
<h3 id="toc_h3_5">Model</h3>
<p>我们先来处理 <strong>model</strong> 先，因为它是三部分中最简单的。它并不涉及任何事件和 <code>DOM</code> 操作。它只是存储和修改数据。</p>
<pre><code class="language-javascript">// Model
class Model {
  constructor() {
    // The state of the model, an array of todo objects, prepopulated with some data
    this.todos = [
      { id: 1, text: 'Run a marathon', complete: false },
      { id: 2, text: 'Plant a garden', complete: false },
    ]
  }

  addTodo(todoText) {
    const todo = {
      id: this.todos.length &gt; 0 ? this.todos[this.todos.length - 1].id + 1 : 1,
      text: todoText,
      complete: false,
    }

    this.todos.push(todo)
  }

  // Map through all todos, and replace the text of the todo with the specified id
  editTodo(id, updatedText) {
    this.todos = this.todos.map(todo =&gt;
      todo.id === id ? { id: todo.id, text: updatedText, complete: todo.complete } : todo
    )
  }

  // Filter a todo out of the array by id
  deleteTodo(id) {
    this.todos = this.todos.filter(todo =&gt; todo.id !== id)
  }

  // Flip the complete boolean on the specified todo
  toggleTodo(id) {
    this.todos = this.todos.map(todo =&gt;
      todo.id === id ? { id: todo.id, text: todo.text, complete: !todo.complete } : todo
    )
  }
}
</code></pre>
<p>我们有一个 <code>addTodo</code>， <code>editTodo</code>， <code>deleteTodo</code> 和 <code>toggleTodo</code>。 这些应该都很容易解析 - 添加一个新的待办事项到数组，编辑查找要编辑的待办事项的 <code>ID</code> 并替换它，删除并过滤器筛选出数组中的待办事项，以及切换 <code>complete</code> 的布尔值。</p>
<p>因为我们都是在浏览器中进行此操作，并且可以从 <code>window(golbal)</code> 中访问应用程序，因此你可以轻松地进行测试，键入以下内容：</p>
<pre><code class="language-javascript">app.model.addTodo('Take a nap')
</code></pre>
<p>上面的命令行将添加一件待办事项到列表中，你可以打印出 <code>app.model.todos</code> 查看。</p>
<p>这对于当前的 <code>model</code> 已经足够了。最后，我们将待办事项存储在 <a href="https://www.taniarascia.com/how-to-use-local-storage-with-javascript/" target="_blank">local storage</a> 中，使其成为永久性文件，但目前，待办事项只要刷新页面就可以刷新了。</p>
<p>如我们所见，<code>model</code> 只是处理实际的数据，并修改数据。它不了解或不知道输入 - 正在修改的内容，或输出 - 最终将显示的内容。</p>
<p>此时，如果你通过控制台手动键入所有操作并在控制台中查看输出，则你的 <code>app</code> 具备了功能全面的 <code>CRUD</code>。</p>
<h3 id="toc_h3_6">View</h3>
<p>我们将通过操作 <strong>DOM</strong>（文档对象模型）来创建视图。由于我们在没有 <code>React</code> 的 <code>JSX</code> 或模版语言的情况下使用纯 <code>JavaScript</code> 进行此操作的，因此它有些冗长和丑陋，但是这就是直接操作 <code>DOM</code> 的本质。</p>
<p><strong>controller</strong> 和 <strong>model</strong> 都不应该了解有关 <code>DOM</code>、<code>HTML</code> 元素、<code>CSS</code> 或者其他方面的信息。任何与这些信息相关的东西都应该在 <strong>view</strong> 层。</p>
<blockquote>
<p>如果你不熟悉 <code>DOM</code> 或 <code>DOM</code> 与 <code>HTML</code> 源码有何不同，阅读下 <a href="https://www.taniarascia.com/introduction-to-the-dom/" target="_blank">Introduction to the DOM</a> 文章。</p>
</blockquote>
<p>我要做的第一件事情就是创建辅助方法检索一个元素并创建一个元素。</p>
<pre><code class="language-javascript">// View
class View {
  constructor() {}

  // Create an element with an optional CSS class
  createElement(tag, className) {
    const element = document.createElement(tag)
    if (className) element.classList.add(className)

    return element
  }

  // Retrieve an element from the DOM
  getElement(selector) {
    const element = document.querySelector(selector)

    return element
  }
}
</code></pre>
<p>到目前为止一切顺利。在构造器中，我将设置我所需的全部内容。那将会：</p>
<ul>
<li>应用程序的根元素 - <code>#root</code></li>
<li>标题 - <code>h1</code></li>
<li>一个表单，输入框和提交按钮去添加事项 - <code>form</code>，<code>input</code>，<code>button</code></li>
<li>待办列表 - <code>ul</code></li>
</ul>
<p>我将使它们成为构造函数中的所有变量，以便我们可以轻松地引用它们。</p>
<pre><code class="language-javascript">// View
class View {
  constructor() {
    // The root element
    this.app = this.getElement('#root')

    // The title of the app
    this.title = this.createElement('h1')
    this.title.textContent = 'Todos'

    // The form, with a [type="text"] input, and a submit button
    this.form = this.createElement('form')

    this.input = this.createElement('input')
    this.input.type = 'text'
    this.input.placeholder = 'Add todo'
    this.input.name = 'todo'

    this.submitButton = this.createElement('button')
    this.submitButton.textContent = 'Submit'

    // The visual representation of the todo list
    this.todoList = this.createElement('ul', 'todo-list')

    // Append the input and submit button to the form
    this.form.append(this.input, this.submitButton)

    // Append the title, form, and todo list to the app
    this.app.append(this.title, this.form, this.todoList)
  }
  // ...
}
</code></pre>
<p>现在，视图不变的部分已经设置好。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/15/170ddc9bc6904b61?w=1406&amp;h=974&amp;f=png&amp;s=55431" alt="view1"></p>
<p>两个小事情 - 输入（新待办事项）值的获取和重置。</p>
<blockquote>
<p>我在方法名称中使用下划线表示它们是私有（本地）的方法，不会在类外部使用。</p>
</blockquote>
<pre><code class="language-javascript">// View
get _todoText() {
  return this.input.value
}

_resetInput() {
  this.input.value = ''
}
</code></pre>
<p>现在所有的设置已经完成了。最复杂的部分是显示待办事项列表，这是每次更改待办事项都会更改的部分。</p>
<pre><code class="language-javascript">// View
displayTodos(todos) {
  // ...
}
</code></pre>
<p><code>displayTodos</code> 方法将创建待办事项列表所组成的 <code>ul</code> 和 <code>li</code>，并显示它们。每次更改，添加，或者删除待办事项时，都会使用模型中的待办事项 <code>todos</code>，再次调用 <code>displayTodos</code> 方法，重置列表并显示它们。这将使得视图和模型的状态保持同步。</p>
<p>我们要做的第一件事是每次调用时都会删除所有待办事项的节点。然后我们将检查是否有待办事项。如果没有，我们将显示一个空列表消息。</p>
<pre><code class="language-javascript">// View
// Delete all nodes
while (this.todoList.firstChild) {
  this.todoList.removeChild(this.todoList.firstChild)
}

// Show default message
if (todos.length === 0) {
  const p = this.createElement('p')
  p.textContent = 'Nothing to do! Add a task?'
  this.todoList.append(p)
} else {
  // ...
}
</code></pre>
<p>现在，我们将遍历待办事项，并为每个现有待办事项显示一个复选框，<code>span</code> 和删除按钮。</p>
<pre><code class="language-javascript">// View
else {
  // Create todo item nodes for each todo in state
  todos.forEach(todo =&gt; {
    const li = this.createElement('li')
    li.id = todo.id

    // Each todo item will have a checkbox you can toggle
    const checkbox = this.createElement('input')
    checkbox.type = 'checkbox'
    checkbox.checked = todo.complete

    // The todo item text will be in a contenteditable span
    const span = this.createElement('span')
    span.contentEditable = true
    span.classList.add('editable')

    // If the todo is complete, it will have a strikethrough
    if (todo.complete) {
      const strike = this.createElement('s')
      strike.textContent = todo.text
      span.append(strike)
    } else {
      // Otherwise just display the text
      span.textContent = todo.text
    }

    // The todos will also have a delete button
    const deleteButton = this.createElement('button', 'delete')
    deleteButton.textContent = 'Delete'
    li.append(checkbox, span, deleteButton)

    // Append nodes to the todo list
    this.todoList.append(li)
  })
}
</code></pre>
<p>现在视图和模型都设置好了。我们只是还没办法连接它们 - 没有事件监听用户的输入，也没有处理程序来处理此类事件的输出。</p>
<p>控制台仍然作为临时控制器存在，你可以通过它添加和删除待办事项。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/15/170ddc9b8d42396f?w=2216&amp;h=1534&amp;f=png&amp;s=103075" alt="view2"></p>
<h3 id="toc_h3_7">Controller</h3>
<p>最后，控制器是模型（数据）和视图（用户所见）之间的连接。到目前为止，下面就是控制器中的内容。</p>
<pre><code class="language-javascript">// Controller
class Controller {
  constructor(model, view) {
    this.model = model
    this.view = view
  }
}
</code></pre>
<p>视图和模型之间的第一个连接是创建一个方法，该方法在每次待办事项更改时调用 <code>displayTodos</code>。我们也可以在构造函数中调用一次，以显示初始待办事项，如果有。</p>
<pre><code class="language-javascript">// Controller
class Controller {
  constructor(model, view) {
    this.model = model
    this.view = view

    // Display initial todos
    this.onTodoListChanged(this.model.todos)
  }

  onTodoListChanged = todos =&gt; {
    this.view.displayTodos(todos)
  }
}
</code></pre>
<p>触发事件之后，控制器将对其进行处理。当你提交新的待办事项，单击删除按钮或单击待办事项的复选框时，将触发一个事件。视图必须监听那些事件，因为它是视图中用户的输入，但是它将把响应该事件将要发生的事情责任派发到控制器。</p>
<p>我们将在控制器中为事项创建处理程序。</p>
<pre><code class="language-javascript">// View
handleAddTodo = todoText =&gt; {
  this.model.addTodo(todoText)
}

handleEditTodo = (id, todoText) =&gt; {
  this.model.editTodo(id, todoText)
}

handleDeleteTodo = id =&gt; {
  this.model.deleteTodo(id)
}

handleToggleTodo = id =&gt; {
  this.model.toggleTodo(id)
}
</code></pre>
<h4 id="toc_h4_8">设置事件监听器</h4>
<p>现在我们有了这些处理程序，但是控制器仍然不知道何时调用它们。我们必须将事件监听器放在视图的 <code>DOM</code> 元素上。我们将响应表单上的 <code>submit</code> 事件，然后单击 <code>click</code> 并更改 <code>change</code> 待办事项列表上的事件。（由于略为复杂，我这里略过"编辑"）。</p>
<pre><code class="language-View">// View
bindAddTodo(handler) {
  this.form.addEventListener('submit', event =&gt; {
    event.preventDefault()

    if (this._todoText) {
      handler(this._todoText)
      this._resetInput()
    }
  })
}

bindDeleteTodo(handler) {
  this.todoList.addEventListener('click', event =&gt; {
    if (event.target.className === 'delete') {
      const id = parseInt(event.target.parentElement.id)

      handler(id)
    }
  })
}

bindToggleTodo(handler) {
  this.todoList.addEventListener('change', event =&gt; {
    if (event.target.type === 'checkbox') {
      const id = parseInt(event.target.parentElement.id)

      handler(id)
    }
  })
}
</code></pre>
<p>我们需要从视图中调用处理程序，因此我们将监听事件的方法绑定到视图。</p>
<blockquote>
<p>我们使用箭头函数来处理事件。这允许我们直接使用 <code>controller</code> 的上下文 <code>this</code> 来调用 <code>view</code> 中的表单。如果你不使用箭头函数，我们需要手动 <code>bind</code> 绑定它们，比如 <code>this.view.bindAddTodo(this.handleAddTodo.bind(this))</code>。咦 ～</p>
</blockquote>
<pre><code class="language-javascript">// Controller
this.view.bindAddTodo(this.handleAddTodo)
this.view.bindDeleteTodo(this.handleDeleteTodo)
this.view.bindToggleTodo(this.handleToggleTodo)
// this.view.bindEditTodo(this.handleEditTodo) - We'll do this one last
</code></pre>
<p>现在，当一个 <code>submit</code>,<code>click</code> 或者 <code>change</code> 事件在特定的元素中触发，相应的处理事件将被唤起。</p>
<h4 id="toc_h4_9">响应模型中的回调</h4>
<p>我们遗漏了一些东西 - 事件正在监听，处理程序被调用，但是什么也没有发生。这是因为模型不知道视图应该更新，也不知道如何进行视图的更新。我们在视图上有 <code>displayTodos</code> 方法来解决此问题，但是如前所述，模型和视图不互通。</p>
<p>就像监听起那样，模型应该触发回来控制器这里，以便其知道发生了某些事情。</p>
<p>我们已经在控制器上创建了 <code>onTodoListChanged</code> 方法来处理此问题，我们只需要使模型知道它就可以了。我们将其绑定到模型上，就像绑定到视图的方式一样。</p>
<p>在模型上，为 <code>onTodoListChanged</code> 添加 <code>bindTodoListChanged</code> 方法。</p>
<pre><code class="language-javascript">// Model
bindTodoListChanged(callback) {
  this.onTodoListChanged = callback
}
</code></pre>
<p>然后将其绑定到控制器中，就像与视图一样。</p>
<pre><code class="language-javascript">// Controller
this.model.bindTodoListChanged(this.onTodoListChanged)
</code></pre>
<p>现在，在模型中的每个方法之后，你将调用 <code>onTodoListChanged</code> 回调。</p>
<pre><code class="language-javascript">// Model
deleteTodo(id) {
  this.todos = this.todos.filter(todo =&gt; todo.id !== id)

  this.onTodoListChanged(this.todos)
}
</code></pre>
<h4 id="toc_h4_10">添加 local storage</h4>
<p>至此，该应用程序已基本完成，所有概念都已演示。通过将数据持久保存在浏览器的本地存储中，我们可以使其更加持久，因此刷新后将在本地持久保存。</p>
<blockquote>
<p>如果你不熟悉 <code>local storage</code> 是怎么工作的，阅读下 <a href="https://www.taniarascia.com/how-to-use-local-storage-with-javascript/" target="_blank">How to Use Local Storage with JavaScript</a> 文章。</p>
</blockquote>
<p>现在，我们可以将初始化待办事项设置为本地存储或空数组中的值。</p>
<pre><code class="language-javascript">// Model
class Model {
  constructor() {
    this.todos = JSON.parse(localStorage.getItem('todos')) || []
  }
}
</code></pre>
<p>我们将创建一个 <code>commit</code> 的私有方法来更新 <code>localStorage</code> 的值，作为模型的状态。</p>
<pre><code class="language-javascript">_commit(todos) {
  this.onTodoListChanged(todos)
  localStorage.setItem('todos', JSON.stringify(todos))
}
</code></pre>
<p>在每次 <code>this.todos</code> 发生更改之后，我们可以调用它。</p>
<pre><code class="language-javascript">deleteTodo(id) {
  this.todos = this.todos.filter(todo =&gt; todo.id !== id)

  this._commit(this.todos)
}
</code></pre>
<h4 id="toc_h4_11">添加实时编辑功能</h4>
<p>这个难题的最后一部分是编现有待办事项的能力。与添加和删除相比，编辑总是有些棘手。我想简化它，不需要编辑按钮，用输入框 <code>input</code> 或其他来代替 <code>span</code>。我们也不想每次输入时都调用 <code>editTodo</code>，因为它将渲染整个待办事项列表 <code>UI</code>。</p>
<p>我决定在视图上创建一个方法，用新的编辑值更新一个临时状态变量，然后在视图中创建一个方法，该方法在控制器中调用 <code>handleEditTodo</code> 方法来更新模型。输入事件是当你键入 <code>contenteditable</code> 元素时触发事件，而 <code>foucesout</code> 在你离开 <code>contenteditable</code> 元素时候触发的事件。</p>
<pre><code class="language-javascript">// View
constructor() {
  // ...
  this._temporaryTodoText
  this._initLocalListeners()
}

// Update temporary state
_initLocalListeners() {
  this.todoList.addEventListener('input', event =&gt; {
    if (event.target.className === 'editable') {
      this._temporaryTodoText = event.target.innerText
    }
  })
}

// Send the completed value to the model
bindEditTodo(handler) {
  this.todoList.addEventListener('focusout', event =&gt; {
    if (this._temporaryTodoText) {
      const id = parseInt(event.target.parentElement.id)

      handler(id, this._temporaryTodoText)
      this._temporaryTodoText = ''
    }
  })
}
</code></pre>
<p>现在，当你单击任何待办事项时，你将进入"编辑"模式，这将更新临时临时状态变量，并且在你选择或者单击离开待办事件时，它将保存在模型中并重置临时状态。		<br>
只需要确保绑定 <code>editTodo</code> 处理程序就可以。</p>
<pre><code class="language-javascript">this.view.bindEditTodo(this.handleEditTodo)
</code></pre>
<blockquote>
<p>该 <code>contenteditable</code> 解决方案得以快速实施。在生产环境中使用 <code>contenteditable</code> 时，你需要考虑各种问题，<a href="https://www.taniarascia.com/content-editable-elements-in-javascript-react/" target="_blank">many of which I've written about here</a></p>
</blockquote>
<h3 id="toc_h3_12">总结</h3>
<p>现在实现它了。使用纯 <code>JavaScript</code> 的无依赖待办事项应用程序，演示了<strong>模型-视图-控制器</strong>结构的概念。下面再次放出完整案例和源码地址。</p>
<ul>
<li><a href="https://taniarascia.github.io/mvc" target="_blank">View demo</a></li>
<li><a href="https://github.com/taniarascia/mvc" target="_blank">View source</a></li>
</ul>
<h3 id="toc_h3_13">小 Demo</h3>
<p>翻译到此结束，上面是经典的 <code>todo list</code> 展示，引入 <code>localstorage</code> 也许有些不好理解。我们来个小的案例巩固下：</p>
<pre><code class="language-html">&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;demo&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="root"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script&gt;
  class Model {
    constructor() {
      this.count = 0
    }
    increastCount() {
      this.count += 1
      console.log(this.count)
      this.showCount(this.count)
    }
    bindCountChange(cb) {
      this.showCount = cb
    }
  }
  class View {
    constructor() {
      this.app = document.querySelector('#root')
      this.div = document.createElement('div')
      this.button = document.createElement('button')
      this.button.textContent = 'increase'
      this.button.classList = 'increase'
      this.app.append(this.div)
      this.app.append(this.button)
    }

    bindIncrease(handler) {
      this.button.addEventListener('click', event =&gt; {
        if(event.target.className === 'increase') {
          handler()
        }
      })
    }

    displayCount(count) {
      this.div.textContent = `current count is ${count}`
    }
  }
  class Controller {
    constructor(model, view) {
      this.model = model
      this.view = view

      this.model.bindCountChange(this.showCount)
      this.view.bindIncrease(this.handleIncrease)

      this.showCount(this.model.count)
    }

    handleIncrease = () =&gt; {
      this.model.increastCount()
    }

    showCount = count =&gt; {
      this.view.displayCount(count)
    }
  }
  const app = new Controller(new Model(), new View())
&lt;/script&gt;
&lt;/html&gt;
</code></pre>
<p>上面实现的功能是点击 <code>increase</code> 按钮递增数字，如下动图：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/15/170ddc9db677f9ca?w=354&amp;h=188&amp;f=gif&amp;s=32535" alt="mvc demo"></p>
<h3 id="toc_h3_14">后话</h3>
<ul>
<li>原文： <a href="https://www.taniarascia.com/javascript-mvc-todo-app/" target="_blank">https://www.taniarascia.com/javascript-mvc-todo-app/</a></li>
</ul>
                        <div>
                            <hr>

标题：【译】用纯JavaScript写一个简单的MVC App<br>
作者：<a href="https://ymfed.github.io" target="_blank">reng99</a><br>
地址：<a href="https://ymfed.github.io/articles/2020/03/16/1584343679745.html" target="_blank">https://ymfed.github.io/articles/2020/03/16/1584343679745.html</a><br>

<!-- 签名档内可使用 HTML、JavaScript -->
<br>
                        </div>
                </div>

                <footer class="tags">
                        <a class="tag" rel="tag" href="https://ymfed.github.io/tags/javascript">
                            javascript</a>
                        <a class="tag" rel="tag" href="https://ymfed.github.io/tags/mvc">
                            mvc</a>

                    <div class="rel fn-clear ft__center">
                            <a href="https://ymfed.github.io/articles/2020/02/27/1582784640439.html" rel="prev"
                               class="fn-left vditor-tooltipped vditor-tooltipped__n"
                               aria-label="谈谈js的防抖和节流">
                                旧一篇
                            </a>
                            <a href="https://ymfed.github.io/articles/2020/03/20/1584706077495.html" rel="next"
                               class="fn-right vditor-tooltipped vditor-tooltipped__n"
                               aria-label="WebSocket的简单教程">
                                新一篇
                            </a>
                    </div>
                </footer>
                    <div id="b3logsolocomments"></div>
                    <div id="vcomment" data-name="reng99" data-postId="1584343679745"></div>
                <br>
                <div id="externalRelevantArticles" class="list"></div>
                <div id="relevantArticles" class="list"></div>
                <div id="randomArticles" class="list"></div>
            </article>
        </main>
<aside>
<ul class="article__toc">
        <li class="toc__h3">
            <a href="#toc_h3_0">前置条件</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_1">目标</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_2">什么是 MVC?</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_3">初始化设置</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_4">开始</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_5">Model</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_6">View</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_7">Controller</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_8">设置事件监听器</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_9">响应模型中的回调</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_10">添加 local storage</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_11">添加实时编辑功能</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_12">总结</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_13">小 Demo</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_14">后话</a>
        </li>
</ul></aside>
    </div>
</div>
<footer class="footer fn-clear">
    &copy; 2020
    <a href="https://ymfed.github.io">亚美大前端（FED）</a>
    
    <br/>
    Powered by <a href="https://solo.b3log.org" target="_blank">YMFED</a>
    <span class="ft-warn">&heartsuit;</span>
    Theme
    <sup>[<a href="javascript:;" target="_blank">ref</a>]</sup>
    by <a href="javascript:;" target="_blank">亚美Web团队</a>
</footer>
<div class="icon-up" onclick="Util.goTop()"></div>
<script>
  var Label = {
    servePath: "https://ymfed.github.io",
    staticServePath: "https://ymfed.github.io",
    luteAvailable: false,
    hljsStyle: 'github',
    langLabel: "zh_CN",
    version: "3.9.0",
    staticSite: true,
    showCodeBlockLn: false,
  }
</script>
<script src="https://ymfed.github.io/skins/9IPHP/js/common.min.js?1585645466987"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.6/index.css"/>
<script async src="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.6/index.js"></script>
<div class="solo-kanbanniang">
    <div class="solo-kanbanniang__tip"></div>
    <canvas id="soloKanbanniang" width="280" height="250"></canvas>
    <div class="solo-kanbanniang__tool">
        <svg id="soloKanbanniangHome" viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32 18.967l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18.516v12h-8v-8h-8v8h-8v-12l12-9z"></path>
        </svg>
        <svg id="soloKanbanniangRSS" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M320.364 768q0 45.728-32 77.728t-77.728 32-77.728-32-32-77.728 32-77.728 77.728-32 77.728 32 32 77.728zM612.94 838.272q1.152 16-9.728 27.424-10.272 12-26.848 12h-77.152q-14.272 0-24.576-9.44t-11.424-23.712q-12.576-130.848-105.44-223.712t-223.712-105.44q-14.272-1.152-23.712-11.424t-9.44-24.576V402.24q0-16.576 12-26.848 9.728-9.728 24.576-9.728h2.848q91.424 7.424 174.848 46.016t148 103.712q65.152 64.576 103.712 148t46.016 174.848z m292.576 1.152q1.152 15.424-10.272 26.848-10.272 11.424-26.272 11.424h-81.728q-14.848 0-25.44-10.016t-11.136-24.288q-6.848-122.848-57.728-233.44t-132.288-192-192-132.288-233.44-58.272q-14.272-0.576-24.288-11.136t-10.016-24.864V109.664q0-16 11.424-26.272 10.272-10.272 25.152-10.272h1.728q149.728 7.424 286.56 68.576t243.136 168q106.848 106.272 168 243.136t68.576 286.56z"></path>
        </svg>
        <svg id="soloKanbanniangChat" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M802.42709 96.163153H219.476155c-84.48109 0-154.896836 71.746044-154.896836 157.840888v393.119449c0 86.072331 70.415746 157.819398 154.896836 157.819399h214.038818V925.470963s22.526039 40.168862 64.767096 5.734608c30.965246-25.819039 126.721123-91.828428 171.775248-123.385145h132.369773c84.502579 0 154.896836-83.21526 154.896836-157.839865V251.125481c0-86.094844-70.394257-154.962328-154.896836-154.962328zM301.144176 518.002714c-39.427988 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044 39.426965 0 70.393233 31.577183 70.393234 71.746044 0 40.169885-30.966269 71.746044-70.393234 71.746044z m208.411657 0c-39.450501 0-70.415746-31.576159-70.415746-71.746044 0-40.168862 30.965246-71.746044 70.415746-71.746044 39.405475 0 70.394257 31.577183 70.394257 71.746044 0 40.169885-30.988782 71.746044-70.394257 71.746044z m211.203236 0c-39.426965 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044s70.415746 31.577183 70.415746 71.746044c-0.001023 40.169885-30.988782 71.746044-70.415746 71.746044z"></path>
        </svg>
        <svg id="soloKanbanniangChange" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M936.672 193.216l-226.88-64c-8.704-2.528-18.112-1.12-25.824 3.776-7.68 4.864-12.896 12.736-14.432 21.728C655.712 236.928 595.328 288 512 288c-71.424 0-142.464-103.296-163.776-143.104-7.136-13.28-22.528-19.84-37.024-15.68l-224 64C73.472 197.152 64 209.728 64 224v256a31.93 31.93 0 0 0 11.712 24.736c7.392 6.08 17.152 8.512 26.56 6.624L224 487.04V832c0 52.928 43.072 96 96 96h384c52.928 0 96-43.072 96-96V519.04l121.728 24.352c9.44 1.92 19.2-0.544 26.56-6.624C955.68 530.656 960 521.6 960 512V224c0-14.336-9.536-26.912-23.328-30.784zM672 800H352c-17.664 0-32-14.304-32-32s14.336-32 32-32h320c17.696 0 32 14.304 32 32s-14.304 32-32 32z"></path>
        </svg>
        <svg id="soloKanbanniangPhoto" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M898.048 258.048q23.552-1.024 46.592 9.216t40.96 27.136 28.672 39.424 10.752 46.08l0 390.144q0 24.576-10.752 47.104t-28.672 40.448-40.96 28.16-47.616 10.24l-697.344 0q-24.576 0-48.64-10.24t-42.496-27.648-29.696-40.448-11.264-48.64l0-381.952q0-22.528 10.752-45.568t28.672-41.472 39.936-30.208 44.544-11.776l63.488 0 13.312-83.968q3.072-20.48 18.432-32.768t34.816-12.288l456.704 0q19.456 0 34.304 10.752t16.896 34.304l14.336 83.968 54.272 0zM548.864 712.704q40.96 0 77.824-15.872t63.488-42.496 42.496-62.976 15.872-77.312-15.872-77.312-42.496-62.976-63.488-42.496-77.824-15.872-77.312 15.872-63.488 42.496-43.008 62.976-15.872 77.312 15.872 77.312 43.008 62.976 63.488 42.496 77.312 15.872z"></path>
        </svg>
        <svg id="soloKanbanniangGithub" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M1024 524.8c0 114.346667-32.554667 217.216-97.706667 308.565333-65.066667 91.306667-149.162667 154.538667-252.288 189.610667-11.989333 2.304-20.778667 0.682667-26.325333-4.778667a27.605333 27.605333 0 0 1-8.362667-20.48v-144.213333c0-44.16-11.52-76.501333-34.645333-97.024 25.344-2.730667 48.085333-6.826667 68.309333-12.288a268.629333 268.629333 0 0 0 62.72-26.666667 187.434667 187.434667 0 0 0 53.973334-45.44c14.421333-18.005333 26.197333-41.898667 35.328-71.765333 9.088-29.824 13.653333-64.128 13.653333-102.826667 0-55.125333-17.536-102.058667-52.650667-140.8 16.426667-41.429333 14.677333-87.893333-5.333333-139.392-12.458667-4.096-30.464-1.578667-54.016 7.509334a355.328 355.328 0 0 0-61.312 30.08L640 271.274667a462.336 462.336 0 0 0-128-17.749334c-43.989333 0-86.656 5.930667-128 17.749334a589.824 589.824 0 0 0-28.330667-18.432c-11.776-7.253333-30.336-16.042667-55.68-26.325334-25.344-10.24-44.416-13.312-57.301333-9.216-19.584 51.498667-21.12 97.962667-4.693333 139.434667-35.114667 38.698667-52.650667 85.632-52.650667 140.757333 0 38.698667 4.565333 72.874667 13.653333 102.485334 9.130667 29.610667 20.778667 53.546667 34.986667 71.765333 14.250667 18.218667 32.128 33.493333 53.674667 45.781333 21.546667 12.288 42.453333 21.205333 62.677333 26.666667 20.224 5.461333 43.008 9.557333 68.309333 12.288-17.749333 16.384-28.629333 39.850667-32.64 70.4a130.005333 130.005333 0 0 1-29.994666 10.24c-10.666667 2.261333-23.338667 3.413333-37.973334 3.413333-14.72 0-29.269333-4.906667-43.690666-14.677333-14.464-9.813333-26.794667-24.064-36.992-42.709333a109.226667 109.226667 0 0 0-32.341334-35.541334c-13.141333-9.130667-24.106667-14.592-33.024-16.426666l-13.312-2.048c-9.344 0-15.786667 1.024-19.328 3.072-3.584 2.090667-4.693333 4.693333-3.328 7.893333 1.28 3.157333 3.328 6.4 5.973334 9.557333 2.688 3.2 5.546667 5.930667 8.661333 8.192l4.693333 3.413334c9.770667 4.565333 19.413333 13.226667 29.013334 25.984 9.514667 12.757333 16.512 24.362667 20.992 34.858666l6.656 15.701334c5.76 17.322667 15.530667 31.317333 29.312 42.026666 13.781333 10.666667 28.672 17.536 44.672 20.48 16 2.986667 31.445333 4.565333 46.336 4.821334 14.890667 0.213333 27.221333-0.597333 36.992-2.389334l15.36-2.730666c0 17.28 0.085333 37.546667 0.298666 60.8l0.341334 36.906666a27.050667 27.050667 0 0 1-8.661334 20.48c-5.76 5.461333-14.677333 7.082667-26.666666 4.778667-103.125333-35.072-187.221333-98.261333-252.330667-189.610667C32.554667 742.058667 0 639.146667 0 524.8c0-95.232 22.869333-183.04 68.693333-263.466667A516.266667 516.266667 0 0 1 254.976 70.4C333.44 23.466667 419.114667 0 512 0c92.885333 0 178.56 23.466667 256.981333 70.4a516.266667 516.266667 0 0 1 186.368 190.976C1001.130667 341.802667 1024 429.653333 1024 524.842667z"></path>
        </svg>
        <svg id="soloKanbanniangClose" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M517.572566143763 1018.6748601482986C238.26554897656422 1018.6748601482986 11.897910175114305 792.2714997690043 11.897910175114305 513.0002041796496c0-279.3070171671984 226.36763880144977-505.71037754649296 505.6746559686481-505.71037754649296 279.2712955893538 0 505.6746559686481 226.40336037929444 505.6746559686481 505.71037754649296C1023.2472221124112 792.2714997690043 796.8795833109612 1018.6748601482986 517.572566143763 1018.6748601482986zM754.7281214542927 339.25044954334646c13.752807470184345-13.752807470184345 9.680547595895998-40.186775075214015-9.073280772537204-58.94060344364717l-2.143294670678079-2.1075730928334457c-18.7538283684332-18.7538283684332-45.15207439561819-22.861809820566194-58.90488186580257-9.073280772537204l-168.21291007038468 168.24863164822932-180.42968969324974-180.46541127109438c-13.967136937252159-13.967136937252159-40.72259874288353-9.823433907274534-59.72647815622916 9.216167083915742l-2.143294670678079 2.143294670678079c-19.039600991190277 19.003879413345654-23.111860865478626 45.75934121897699-9.180445506071107 59.655035000539876l180.42968969324974 180.46541127109438-176.07165719620428 176.03593561835962c-13.788529048028984 13.824250625873615-9.716269173740633 40.151053497369375 9.073280772537204 58.94060344364717l2.1075730928334457 2.1075730928334457c18.7538283684332 18.7538283684332 45.15207439561819 22.897531398410823 58.90488186580257 9.073280772537204l176.10737877404887-176.10737877404887 170.39192631890742 170.42764789675192c13.967136937252159 13.931415359407513 40.686877165038865 9.85915548511917 59.690756578384516-9.180445506071107l2.1790162485227142-2.1790162485227142c19.039600991190277-18.968157835501014 23.147582443323273-45.72361964113239 9.180445506071107-59.690756578384516l-170.39192631890742-170.42764789675192L754.7281214542927 339.25044954334646z"></path>
        </svg>
    </div>
</div>

<script type="text/javascript">
    Util.addScript('https://ymfed.github.io/js/page.min.js?1585645466987', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论内容只能为 2 到 500 个字符！",
        "oId": "1584343679745",
        "blogHost": "https://ymfed.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "0";
    Skin.initToc()
    page.share()
    });
</script>
</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 27ms, 2020/06/24 15:11:33 -->