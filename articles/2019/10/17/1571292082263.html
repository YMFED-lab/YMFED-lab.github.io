<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>移动端页面适配——多方案解析 - 亚美大前端（FED）</title><meta name="description" content="在移动互联网快速发展的今天，手机的种类和尺寸越来越多，作为前端的小伙伴们可能会越来越头疼，但又不得不去适配一款又一款的新机型"/><meta property="og:description" content="在移动互联网快速发展的今天，手机的种类和尺寸越来越多，作为前端的小伙伴们可能会越来越头疼，但又不得不去适配一款又一款的新机型"/>    <meta name="keywords" content="YM,亚美,前端,博客"/><link rel="dns-prefetch" href="https://ymfed.github.io"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://ymfed.github.io"><link rel="icon" type="image/png" href="http://fed.ym/images/czh-fed-logo.png"/><link rel="apple-touch-icon" href="http://fed.ym/images/czh-fed-logo.png"><link rel="shortcut icon" type="image/x-icon" href="http://fed.ym/images/czh-fed-logo.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="移动端页面适配——多方案解析 - 亚美大前端（FED）"/><meta property="og:site_name" content="亚美大前端（FED）"/><meta property="og:url"      content="https://ymfed.github.io/articles/2019/10/17/1571292082263.html?"/><meta property="og:image" content="http://fed.ym/images/czh-fed-logo.png"/><link rel="search" type="application/opensearchdescription+xml" title="移动端页面适配——多方案解析 - 亚美大前端（FED）" href="/opensearch.xml"><link href="https://ymfed.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://ymfed.github.io/manifest.json">        <link rel="canonical" href="https://ymfed.github.io/articles/2019/10/17/1571292082263.html">        <link rel="stylesheet"
              href="https://ymfed.github.io/skins/9IPHP/css/base.css?1585645466987"/>
            <link rel="prev" title="es6-你可能不知道的事儿" href="https://ymfed.github.io/articles/2019/09/29/1569746400468.html">
            <link rel="next" title="11个有用的Vue开发技巧" href="https://ymfed.github.io/articles/2019/10/17/1571310065783.html">
    </head>
<body>
<header>
    <div class="banner">
        <div class="fn-clear wrapper">
            <a href="https://ymfed.github.io" class="logo" rel="start"></a>
            <h2 class="subtitle-wrap">
                <p class="subtitle">亚美大前端（FED）</p>
                <p class="description">既要埋头干事，也要抬头看路</p>
            </h2>
            <div class="fn-right">
                    <a class="fn__flex-inline" href="https://ymfed.github.io/start">
                        <i class="icon-login"></i>&nbsp;开始使用
                    </a>
            </div>
        </div>
    </div>

    <div class="navbar">
        <div class="fn-clear wrapper">
            <nav class="fn-left">
                <a href="https://ymfed.github.io">
                    <i class="icon-home"></i>
                    首页
                </a>
                <a href="https://ymfed.github.io/tags.html" rel="section">
                    <i class="icon-tags"></i> 标签墙
                </a>
                <a href="https://ymfed.github.io/archives.html">
                    <i class="icon-inbox"></i> 存档
                </a>
                <a rel="archive" href="https://ymfed.github.io/links.html">
                    <i class="icon-link"></i> 友情链接
                </a>
                <a rel="archive" href="https://ymfed.github.io/team.html">
                    <i class="icon-category"></i> 团队介绍
                </a>
                <a rel="archive" href="https://ymfed.github.io/join.html">
                    <i class="icon-register"></i> 加入我们
                </a>
            </nav>
            <div class="fn-right">
                <form class="form" action="https://ymfed.github.io/search">
                    <input placeholder="搜索" id="search" type="text" name="keyword"/>
                    <button type="submit"><i class="icon-search"></i></button>
                </form>
            </div>
        </div>
    </div>
</header>
<div class="responsive fn-none">
    <i class="icon-list"></i>
    <ul class="list">
                <li>
                    <a href="https://ymfed.github.io/start">
                        <i class="icon-login"></i> 开始使用
                    </a>
                </li>
        <li>
            <a href="https://ymfed.github.io">
                <i class="icon-home"></i>
                首页
            </a>
        </li>
        <li>
            <a href="https://ymfed.github.io/tags.html" rel="section">
                <i class="icon-tags"></i> 标签墙
            </a>
        </li>
        <li>
            <a href="https://ymfed.github.io/archives.html">
                <i class="icon-inbox"></i> 存档
            </a>
        </li>
        <li>
            <a rel="archive" href="https://ymfed.github.io/links.html">
                <i class="icon-link"></i> 友情链接
            </a>
        </li>
        <li>
            <a rel="archive" href="https://ymfed.github.io/team.html">
                <i class="icon-category"></i> 团队介绍
            </a>
        </li>
        <li>
            <a rel="archive" href="https://ymfed.github.io/join.html">
                <i class="icon-register"></i> 加入我们
            </a>
        </li>
    </ul>
</div><div class="wrapper">
    <div class="main-wrap">
        <main>
            <article class="post">
                <header>
                    <h2>
                        <a rel="bookmark" href="https://ymfed.github.io/articles/2019/10/17/1571292082263.html">
                            移动端页面适配——多方案解析
                        </a>
                    </h2>
                    <div class="meta">
                                <span class="vditor-tooltipped vditor-tooltipped__n"
                                      aria-label="更新日期">
                                    <i class="icon-date"></i>
                                    <time>
                                    2019-10-18
                                    </time>
                                </span>
                        &nbsp; | &nbsp;
                        <span class="vditor-tooltipped vditor-tooltipped__n" aria-label="评论数">
                                    <i class="icon-comments"></i>
                                    <a href="https://ymfed.github.io/articles/2019/10/17/1571292082263.html#b3logsolocomments">
                                        <span data-uvstatcmt="1571292082263">0</span> 评论</a>
                                </span>
                        &nbsp; | &nbsp;
                        <span class="vditor-tooltipped vditor-tooltipped__n" aria-label="浏览数">
                                    <i class="icon-views"></i>
                        <span data-uvstaturl="https://ymfed.github.io/articles/2019/10/17/1571292082263.html">102</span> 浏览
                                </span>
                    </div>
                </header>

                <div class="vditor-reset post__content">
                    <p><img src="https://img.hacpai.com/bing/20190919.jpg?imageView2/1/w/960/h/540/interlace/1/q/100" alt=""></p>
<blockquote>
<p>在移动互联网快速发展的今天，手机的种类和尺寸越来越多，作为前端的小伙伴们可能会越来越头疼，但又不得不去适配一款又一款的新机型。对于移动端适配，不同的公司、不同的团队有不同的解决方案。我在项目中也用了一部分解决方案，也看到了一些解决方案，对比下，总结一些自己的理解，希望对各位有帮助，找到最适合你们项目的适配方案。</p>
</blockquote>
<h5 id="toc_h5_0">下面是一些基础概念的讲解，帮助理解各种适配方案实现。</h5>
<h3 id="toc_h3_1">像素：</h3>
<h5 id="toc_h5_2">1、物理像素（设备像素）</h5>
<p>屏幕的物理像素，又被称为设备像素，他是显示设备中一个最微小的物理部件。任何设备屏幕的物理像素出厂时就确定了，且固定不变的。</p>
<h5 id="toc_h5_3">2、设备独立像素</h5>
<p>设备独立像素也称为密度无关像素，可以认为是计算机坐标系统中的一个点，这个点代表一个可以由程序使用的虚拟像素(比如说CSS像素)，然后由相关系统转换为物理像素。</p>
<h5 id="toc_h5_4">3、设备像素比</h5>
<p>设备像素比简称为dpr，其定义了物理像素和设备独立像素的对应关系</p>
<pre><code>设备像素比 ＝ 物理像素 / 设备独立像素
以iphone6为例：
iphone6的设备宽和高为375pt * 667pt，可以理解为设备的独立像素，而其设备像素比为2.固有设备像素为750pt * 1334pt 
</code></pre>
<p>通过：window.devicePixelRatio获得。</p>
<p>设备像素比是区别是否是高清屏的标准，dpr大于1时就为高清屏，一般情况下dpr为整数，但是android有些奇葩机型不为整数。</p>
<h5 id="toc_h5_5">4、css像素</h5>
<p>在CSS、JS中使用的一个长度单位。单位px</p>
<p>注：在pc端1物理像素等于1px，但是移动端1物理像素不一定等于1px，1物理像素与px的关系与以下因素有关。(有些视口概念，可以把下面视口看完了再来看)</p>
<pre><code>1、屏幕布局视口大小(下面会讲到)
2、屏幕的分辨率(物理像素) 
</code></pre>
<p>对于一块屏幕，其物理像素是确定的。视觉视口尺寸是继承的布局视口的，而视觉视口里宽度即是css的px数。故在一块屏上物理像素与px的关系就是物理像素与布局视口的px数的关系。</p>
<pre><code>比如iphone6，期物理像素为750，如果没有设置布局视口时，viewport为980px
此时：1物理像素长度等于980/750px = 1.3067px的长度
由于像素都是点阵的，故1物理像素相当于1.3067px * 1.3067px方格。
当在meta中设置了如下配置时
&lt;meta name="viewport" content="width=device-width"&gt;
相当于把布局视口设置为设备的宽度(即上面讲到的设备独立像素)， 对于iphone6就是375px。
此时1物理像素长度等于375/750px = 0.5px的长度，故1物理像素相当于0.5px * 0.5px的方格。 
</code></pre>
<h3 id="toc_h3_6">视口：</h3>
<h5 id="toc_h5_7">1、布局视口：</h5>
<p>在html中一般在meta中的name为viewport字段就是控制的布局视口。布局视口一般都是浏览器厂商给的一个值。在手机互联网没有普及前，网络上绝大部分页面都是为电脑端浏览而做的，根本没有做移动端的适配。随着移动端的发展，在手机上看电脑端的页面已成为非常普及现象。而电脑端页面宽度较大，移动端宽度有限，要想看到整个网页，会有很长的滚动条，看起来非常麻烦。于是浏览器厂商为了让用户在小屏幕下网页也能够显示地很好，所以把布局视口设置的很大，一般在768px ~ 1024px 之间，最常用的宽度就是 980。这样用户就能看到绝大部分内容，并根据具体内容选择缩放。</p>
<p>故布局视口是看不见的，浏览器厂商设置的一个固定值，如980px，并将980px的内容缩放到手机屏内。</p>
<p>布局视口可以通过：</p>
<p><code>document.documentElement.clientWidth(clientHeight) // 布局视口的尺寸。</code></p>
<h5 id="toc_h5_8">2、视觉视口：</h5>
<p>浏览器可视区域的大小，即用户看到的网页的区域。(其宽度继承的布局视口宽度)</p>
<p><code>window.innerWidth(innerHeight) // 视觉视口尺寸</code></p>
<h5 id="toc_h5_9">3、理想视口:</h5>
<p>布局视口虽然解决了移动端查看pc端网页的问题，但是完全忽略了手机本身的尺寸。所以苹果引入了理想视口，它对设备来说是最理想的布局视口，用户不需要对页面进行缩放就能完美的显示整个页面。最简单的做法就是使布局视口宽度改成屏幕的宽度。</p>
<p>可以通过window.screen.width获取。</p>
<p><code>&lt;meta name="viewport" content="width=device-width"&gt;</code></p>
<p>移动端到底怎么适配不同的屏幕呢？最简单的方法是设置如下视口：</p>
<p><code>&lt;meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"&gt;</code></p>
<p>当使用以上方案定义布局视口时，即布局视口等于理想视口（屏幕宽度），屏幕没有滚动条，不存在高清屏下，字体较小的问题。但是在不同屏幕上，其视觉宽度是不同的，不能简单的将所有的尺寸都设置为px，可能会出现滚动条。小尺寸的可以用px，大尺寸的只能用百分比和弹性布局。</p>
<h4 id="toc_h4_10">viewport缩放</h4>
<p>对于上面的设置，再不同的屏幕上，css像素对应的物理像素具数是不一致的。</p>
<p>在普通屏幕下，dpr=1时，</p>
<p>1个css像素长度对应1个物理像素长度，1个css像素对应1个物理像素。</p>
<p>而在Retina屏幕下，如果dpr=2，</p>
<p>1个css像素长度对应2个物理像素长度，1css像素对应4个物理像素。</p>
<p>此时如果css中写</p>
<p><code>border: 1px solid red; // 此时1px 对应的宽度是2物理像素的宽度。</code></p>
<p>而一般现在移动端设计稿都是基于iphone设计的，稿子一般为750px或640px，这正好是iphone6和iphone5的物理像素。在设计稿中，一般有些边框效果，这时边框的线宽为1px，对应的就是1物理像素。而对于iphone5和iphone6，当width=device-width时，css的1px显示出来的是2个物理像素，所以看起来线就比较粗。怎么解决呢？1px边框效果其实有很多hack方法，其中一种就是通过缩放viewport。</p>
<p>initial-scale是将布局视口进行缩放，initial-scale是相对于理想视口的，即initial-scale=1与width=device-width是一样的效果。initial-scale=0.5等效于width= 2倍的device-width，所以设置initial-scale和width都可以改变布局视口的大小。</p>
<p><code>&lt;meta name="viewport" content="width=device-width,initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5, user-scalable=no"&gt;</code></p>
<p>对于iphone6当添加如上设置后，initial-scale=0.5,即将页面缩小2倍后等于屏幕宽度。</p>
<pre><code>布局视口width:
width / 2 = 375px; width = 750px; 
</code></pre>
<p>所以此时布局视口为750px，此时1px等于1物理像素。</p>
<h3 id="toc_h3_11">适配方案：</h3>
<p>上面讲了一些基础概念，下面讲具体适配。</p>
<p>对于ui设计师给的一张设计稿，怎么将其还原到页面上？对于不同手机屏幕，其dpr不同，屏幕尺寸也不同，考虑到各种情况，有很多适配方案，所以不同的适配方案，实现方法不同，处理复杂度也不同，还原程度也不同。</p>
<p><strong>方案一</strong>：</p>
<p>固定高度，宽度自适应。</p>
<p>这种方案是目前使用较多的方案，也是相对较简单的实现方案：</p>
<p>该方法使用了理想视口：</p>
<p><code>&lt;meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"&gt;</code></p>
<p>垂直方向使用固定的值，水平方向使用弹性布局，元素采用定值、百分比、flex布局等。这种方案相对简单，还原度也非常低。</p>
<p><strong>方案二：</strong></p>
<p>固定布局视口宽度，使用viewport进行缩放</p>
<p>如：<a href="https://link.jianshu.com/?t=http://m.lizhi.fm/" target="_blank">荔枝FM</a>、<a href="https://link.jianshu.com/?t=https://m.163.com/apps" target="_blank">网易应用</a></p>
<p>荔枝的代码：</p>
<pre><code> if(/Android (\d+\.\d+)/.test(navigator.userAgent)){
  var version = parseFloat(RegExp.$1);
  if(version&gt;2.3){
    var phoneScale = parseInt(window.screen.width)/640;
    if(/MZ-M571C/.test(navigator.userAgent)){
      document.write('&lt;meta name="viewport" content="width=640, minimum-scale = 0.5, maximum-scale= 0.5"&gt;');
    }else if(/M571C/.test(navigator.userAgent)&amp;&amp;/LizhiFM/.test(navigator.userAgent)){
      document.write('&lt;meta name="viewport" content="width=640, minimum-scale = 0.5, maximum-scale= 0.5"&gt;');
    }else{
      document.write('&lt;meta name="viewport" content="width=640, minimum-scale = '+ phoneScale +', maximum-scale = '+ phoneScale +', target-densitydpi=device-dpi"&gt;');
    }
  }else{
    document.write('&lt;meta name="viewport" content="width=640, target-densitydpi=device-dpi"&gt;');
  }
}else{
  document.write('&lt;meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi"&gt;');
} 
</code></pre>
<p>网易应用：</p>
<pre><code>var win = window,
        width = 640,
        iw = win.innerWidth || width,
        ow = win.outerHeight || iw,
        sw = win.screen.width || iw,
        saw = win.screen.availWidth || iw,
        ih = win.innerHeight || width,
        oh = win.outerHeight || ih,
        ish = win.screen.height || ih,
        sah = win.screen.availHeight || ih,
        w = Math.min(iw, ow, sw, saw, ih, oh, ish, sah),
        ratio = w / width,
        dpr = win.devicePixelRatio;
        if (ratio = Math.min(ratio, dpr), 1 &gt; ratio) {
            var ctt = ",initial-scale=" + ratio + ",maximum-scale=" + ratio,
                metas = document.getElementsByTagName("meta");ctt += "";
            for (var i = 0, meta; i &lt; metas.length; i++) meta = metas[i], "viewport" == meta.name &amp;&amp; (meta.content += ctt)
        } 
</code></pre>
<p>固定布局视口，宽度设置固定的值，总宽度为640px，根据屏幕宽度动态生成viewport。（设计稿应该是640px的）</p>
<p><code>&lt;meta name="viewport" content="width=640, minimum-scale = 0.5625, maximum-scale = 0.5625, target-densitydpi=device-dpi"&gt;</code></p>
<p>这种方式布局如荔枝FM的网页宽度始终为640px。缩放比例scale为：</p>
<p><code>var scale = window.screen.width / 640</code></p>
<p>设计稿为640px时，正好可以1:1以px来写样式。但是1px所对应的物理像素就不一定是1了。</p>
<p><code>(window.screen.width * dpr) / 640 // 1px对应的物理像素</code></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4469397-d99842b462437715.png?imageMogr2/auto-orient/strip|imageView2/2/w/328/format/webp" alt="null"></p>
<p>iphone5.png</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4469397-642c1a3732758a1e.png?imageMogr2/auto-orient/strip|imageView2/2/w/390/format/webp" alt="null"></p>
<p>iphone6.png</p>
<p><strong>方案三：</strong></p>
<p>根据不同屏幕动态写入font-size，以rem作为宽度单位，固定布局视口。</p>
<p>如<a href="https://link.jianshu.com/?t=http://3g.163.com/touch/all?dataversion=B&amp;uversion=B&amp;version=v_standard" target="_blank">网易新闻</a>：</p>
<p><code>&lt;meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"&gt;</code></p>
<p>以640px设计稿和750px的视觉稿，网易这样处理的：</p>
<pre><code>var width = document.documentElement.clientWidth;   // 屏幕的布局视口宽度
var rem = width / 7.5;                              // 750px设计稿将布局视口分为7.5份
var rem = width / 6.4;                              // 640px设计稿将布局视口分为6.4份 
</code></pre>
<p>这样不管是750px设计稿还是640px设计稿，1rem 等于设计稿上的100px。故px转换rem时：</p>
<p><code>rem = px * 0.01;</code></p>
<p>在750px设计稿上：</p>
<pre><code>75px 对应 0.75rem, 距离占设计稿的10%；

在ipone6上：
width = document.documentElement.clientWidth = 375px；
rem = 375px / 7.5 = 50px;
0.75rem = 37.5px;   (37.5/375=10%；占屏幕10%)
                     
在ipone5上：
width = document.documentElement.clientWidth = 320px；
rem = 320px / 7.5 = 42.667px;
0.75rem = 32px; (32/320=10%；占屏幕10%) 
</code></pre>
<p>故对于设计稿上任何一个尺寸换成rem后，在任何屏下对应的尺寸占屏幕宽度的百分比相同。故这种布局可以百分比还原设计图。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4469397-87455ae424ba5169.png?imageMogr2/auto-orient/strip|imageView2/2/w/339/format/webp" alt="null"></p>
<p>iphone5-2.png</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4469397-b9d0af7307373567.png?imageMogr2/auto-orient/strip|imageView2/2/w/394/format/webp" alt="null"></p>
<p>iphone6-2.png</p>
<p><strong>方案四：</strong></p>
<p>以rem作为宽度单位，动态写入viewport和font-size进行缩放。</p>
<p>根据设置的dpr设置font-size。如：</p>
<pre><code>document.documentElement.style.fontSize = 50 * dpr;
// dpr 为设置的设备像素比。（注意不是设备自身的设备像素比，而是认为设置的dpr） 
</code></pre>
<p>这种情况下，dpr = 1时，1rem = 50px;</p>
<p>dpr = 2时， 1rem = 100px;</p>
<p>当设计以iphone6为标准，出750px的设计稿时，此时dpr=2，故1rem 等于100px，将图上的尺寸转换为rem非常方便，除以100就行。代码如下：</p>
<pre><code>var scale             = 1.0;
var dpr             = 1;
var isAndroid         = window.navigator.appVersion.match(/android/gi);
var isIPhone          = window.navigator.appVersion.match(/iphone/gi);
var devicePixelRatio  = window.devicePixelRatio;
// 此处只简单对ios做了伸缩处理，安卓没有做伸缩处理，统一dpr = 1
if ( isIPhone ) {
  scale /= devicePixelRatio;
  dpr *= devicePixelRatio;
}

var viewport        = document.getElementById('viewport');
var content         = 'initial-scale=' + scale + ', maximum-scale=' + scale + ',minimum-scale=' + scale + ', width=device-width, user-scalable=no';

viewport.setAttribute( 'content', content );
document.documentElement.style.fontSize = 50 * dpr + 'px';
document.documentElement.setAttribute('data-dpr', dpr); 
</code></pre>
<p>对于该方案，</p>
<pre><code>假设肉眼看到的宽度（视觉宽度）：visualWidth,令dpr=1时，其1rem对应的宽度为50.

dpr = 1 时， 1rem = 50px, initial-scale=1, 缩放为1。
visualWidth = 50 * 1 = 50;

dpr = 2 时， 1rem = 100px, initial-scale=0.5, 缩放为0.5。
visualWidth = 100 * 0.5 = 50;

dpr = 3 时， 1rem = 150px, initial-scale=0.3333, 缩放为0.3333。
visualWidth = 150 * 0.3333 = 50; 
</code></pre>
<p>所以该方案，1rem在所有屏幕上对应的肉眼距离相同，故不同屏幕下，总的rem数不同，大屏下总的rem数大于小屏下，如iphone6下，总宽度为7.5rem，iphone5下，总宽度为6.4rem。故此方案不能百分比还原设计稿，故写样式时，对于大块元素应该用百分比，flex等布局，不能直接用rem。</p>
<p>关于这个方案的详细教程请参考这篇文章<a href="https://www.jianshu.com/p/985d26b40199" target="_blank">传送门</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4469397-73d566f03d895975.png?imageMogr2/auto-orient/strip|imageView2/2/w/333/format/webp" alt="null"></p>
<p>iphone5-3.png</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4469397-4334953699b0b575.png?imageMogr2/auto-orient/strip|imageView2/2/w/391/format/webp" alt="null"></p>
<p>iphone6-3.png</p>
<p><strong>方案五：</strong></p>
<p>根据不同屏幕动态写入font-size和viewport，以rem作为宽度单位</p>
<p>将屏幕分为固定的块数10：</p>
<pre><code>var width = document.documentElement.clientWidth;   // 屏幕的布局视口宽度
var rem = width / 10;                               // 将布局视口分为10份 
</code></pre>
<p>这样在任何屏幕下，总长度都为10rem。1rem对应的值也不固定，与屏幕的布局视口宽度有关。</p>
<p>对于动态生成viewport，他们原理差不多，根据dpr来设置缩放。看看淘宝的：</p>
<pre><code>var devicePixelRatio = window.devicePixelRatio;
var isIPhone = window.navigator.appVersion.match(/iphone/gi);
var dpr,scale;
if (isIPhone) {
  if (devicePixelRatio &gt;=3) {
    dpr = 3;
  } else if (devicePixelRatio &gt;=2) {
    dpr = 2;
  } else {
    dpr = 1;
  }
} else {
  dpr = 1;
}
scale = 1 / dpr; 
</code></pre>
<p>淘宝只对iphone做了缩放处理，对于android所有dpr=1，scale=1即没有缩放处理。</p>
<p>此方案与方案三相似，只是做了viewport缩放，能百分比还原设计稿。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4469397-6fe027bd790ed44b.png?imageMogr2/auto-orient/strip|imageView2/2/w/341/format/webp" alt="null"></p>
<p>iphone5-4.png</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4469397-50cf372174c8517e.png?imageMogr2/auto-orient/strip|imageView2/2/w/391/format/webp" alt="null"></p>
<p>iphone6-4.png</p>
<p><strong>适配中要解决的问题 ：</strong></p>
<p>移动端适配最主要的是使在不同屏幕下不用缩放页面就能正常显示整个页面。以上方案都完成了这一需求。其次有几个需求：</p>
<p>1、解决高清屏下1px的问题，其实有很多hack方法，这里只讲了缩放视口。先将布局视口设置为高清屏的物理像素。这样css中1px就是1个物理像素，这样看到的线条才是真正的1px。但是此时视口宽度大于设备的宽度，就会出现滚动条。故对视口进行缩放，使视口宽度缩放到设备宽度。</p>
<p>淘宝团队在处理安卓端的缩放存在很多问题，所以dpr都做1处理，所以安卓端就没有解决1px的问题。</p>
<p>2、在大屏手机中一行看到的段落文字应该比小屏手机的多。</p>
<p>由于淘宝和网易新闻rem都是百分比，故如果用rem一行显示的文字个数应该是相同的。故对于段落文本不能用rem作为单位，应该用px处理，对于不同的dpr下设置不同的字体。</p>
<pre><code>.selector { 
  color: red; 
  font-size: 14px; 
}

[data-dpr="2"] .selector { 
  font-size: 28px; // 14 * 2
} 

[data-dpr="3"] .selector { 
  font-size: 42px; // 14 * 3
} 
</code></pre>
<p>对于方案四，不管什么情况下，1rem对应的视觉上的宽度都是一样的，而对应的大屏、小屏手机其视觉宽度当然不同，故字体设置为rem单位时，也能满足大屏手机一行显示的字体较多这个需求。</p>
<p><strong>五种方案对比：</strong></p>
<p>上面四种方案对设计稿还原程度是有差别的。</p>
<p>除了方案一和方案四以外，其他方案都是百分比还原设计稿，大屏下元素的尺寸就大。</p>
<p>方案一还原设计稿程度较低，这里不做说明。</p>
<p>方案二做了百分比适配，部分1px适配，没有字体适配。</p>
<p>方案三做了百分比适配，没有1px适配，有字体大小适配。</p>
<p>方案四没有做百分百适配，布局要用百分百和flex布局，做了1px的适配，并且对于段落文字直接可以用rem做单位，不需要做适配。</p>
<p>方案五做了百分比适配，有1px适配，有字体大小适配。</p>
<p><strong>项目中遇到的问题：</strong></p>
<p>在我们项目中方案四和方案五都用过。</p>
<p>方案五在使用中没有遇到什么问题，就是刚开始没有做字体适配都是用的rem，后面加入了字体适配，这种方案设计师相对轻松些，不用考虑在大小屏幕下的布局效果。</p>
<p>方案四时没有跟ui设计师沟通清楚，导致设计师在设计图上一行排了很多交互元素，在小屏下放不下去，又不能简单放百分比（元素里的文字放不下）。所以还是要做动态判断大小屏，做出相应适配。这个方案可能设计师需要考虑的多些，尽量减少一行内的交互元素，当一行交互元素多时要考虑小屏手机怎么适配。</p>
<p>其实对于1px的适配在苹果端很好，在android端各个厂商手机差别太大，适配有很多问题。这是为什么绝大多数方案里都放弃了android端1px适配。不过最近看到很多网站都用了densitydpi=device-dpi这个安卓的私有属性来兼容部分安卓机型，这个属性在新的webkit已经被移除了，使用它主要为了兼容低版本的android系统。</p>
<p>这里大漠老师针对flexible方案进行了改版，兼容了更多的android机型的1px效果。文章<a href="https://link.jianshu.com/?t=http://www.w3cplus.com/css/fix-1px-for-retina.html" target="_blank">传送门</a></p>
<p>他给了个压缩版的方案，我看了下源码，把它写了一遍，不知道有没有问题，效果是一样的。</p>
<pre><code>var dpr, scale, timer, rem;
var style = document.createElement('style');

dpr = window.devicePixelRatio || 1;
scale = 1 / dpr;

document.documentElement.setAttribute('data-dpr', dpr);
var metaEl = document.createElement('meta');
metaEl.setAttribute('name', 'viewport');
metaEl.setAttribute('content', 'target-densitydpi=device-dpi, initial-scale=' + scale + ', maximum-scale=' + scale + ', minimum-scale=' + scale + ', user-scalable=no');
document.documentElement.firstElementChild.appendChild(metaEl);
document.documentElement.firstElementChild.appendChild(style);
if (980 === document.documentElement.clientWidth) {
  metaEl.setAttribute('content', 'target-densitydpi=device-dpi,width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1');
}

function refreshRem () {
  var c = '}';
  var width = document.documentElement.clientWidth;
  var isPhone = window.navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);
  if (!isPhone &amp;&amp; width &gt; 1024) {
    width = 640;
    c = 'max-width:' + width + 'px;margin-right:auto!important;margin-left:auto!important;}';
  }
  window.rem = rem = width / 16;
  style.innerHTML = 'html{font-size:' + rem + 'px!important;}body{font-size:' + parseInt(12 * (width / 320)) + 'px;' + c;;
}

refreshRem();

window.addEventListener('resize', function () {
  clearTimeout(timer);
  timer = setTimeout(refreshRem, 300);
}, false);

window.addEventListener('pageshow', function (e) {
  if (e.persisted) {
    clearTimeout(timer);
    timer = setTimeout(refreshRem, 300);
  }
}, false); 
</code></pre>
<p>这些方案只是针对绝大部分机型，项目中可能有些特殊机型有特殊问题，需要特殊对待。比如在这篇文章中作者使用flexible在小米max和荣耀8中有问题，需要特殊hack。<a href="https://link.jianshu.com/?t=http://web.jobbole.com/91772/" target="_blank">传送门</a>，我没有这种手机，也没有对此做验证。</p>
<p>对于上面的五种方案，方案五看似是适配最好的，但是当项目中引入第三方插件时可能要一一适配，比如：引入一个富文本，里面设置字体大小的一般都是px，你需要将其一一转换成rem。而对于方案二，可以直接用px做单位来百分百还原设计稿，引入的插件时也不用适配。所以说，具体项目中用哪个方案，其实不光是前端的选择，还要跟设计师讨论下，满足设计需求，选择最适合项目的方案。</p>
                        <div>
                            <hr>

标题：移动端页面适配——多方案解析<br>
作者：<a href="https://ymfed.github.io" target="_blank">wasdlxm</a><br>
地址：<a href="https://ymfed.github.io/articles/2019/10/17/1571292082263.html" target="_blank">https://ymfed.github.io/articles/2019/10/17/1571292082263.html</a><br>

<!-- 签名档内可使用 HTML、JavaScript -->
<br>
                        </div>
                </div>

                <footer class="tags">
                        <a class="tag" rel="tag" href="https://ymfed.github.io/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%80%82%E9%85%8D">
                            移动端适配</a>
                        <a class="tag" rel="tag" href="https://ymfed.github.io/tags/rem">
                            rem</a>

                    <div class="rel fn-clear ft__center">
                            <a href="https://ymfed.github.io/articles/2019/09/29/1569746400468.html" rel="prev"
                               class="fn-left vditor-tooltipped vditor-tooltipped__n"
                               aria-label="es6-你可能不知道的事儿">
                                旧一篇
                            </a>
                            <a href="https://ymfed.github.io/articles/2019/10/17/1571310065783.html" rel="next"
                               class="fn-right vditor-tooltipped vditor-tooltipped__n"
                               aria-label="11个有用的Vue开发技巧">
                                新一篇
                            </a>
                    </div>
                </footer>
                    <div id="b3logsolocomments"></div>
                    <div id="vcomment" data-name="wasdlxm" data-postId="1571292082263"></div>
                <br>
                <div id="externalRelevantArticles" class="list"></div>
                <div id="relevantArticles" class="list"></div>
                <div id="randomArticles" class="list"></div>
            </article>
        </main>
<aside>
<ul class="article__toc">
        <li class="toc__h5">
            <a href="#toc_h5_0">下面是一些基础概念的讲解，帮助理解各种适配方案实现。</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_1">像素：</a>
        </li>
        <li class="toc__h5">
            <a href="#toc_h5_2">1、物理像素（设备像素）</a>
        </li>
        <li class="toc__h5">
            <a href="#toc_h5_3">2、设备独立像素</a>
        </li>
        <li class="toc__h5">
            <a href="#toc_h5_4">3、设备像素比</a>
        </li>
        <li class="toc__h5">
            <a href="#toc_h5_5">4、css像素</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_6">视口：</a>
        </li>
        <li class="toc__h5">
            <a href="#toc_h5_7">1、布局视口：</a>
        </li>
        <li class="toc__h5">
            <a href="#toc_h5_8">2、视觉视口：</a>
        </li>
        <li class="toc__h5">
            <a href="#toc_h5_9">3、理想视口:</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_10">viewport缩放</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_11">适配方案：</a>
        </li>
</ul></aside>
    </div>
</div>
<footer class="footer fn-clear">
    &copy; 2020
    <a href="https://ymfed.github.io">亚美大前端（FED）</a>
    
    <br/>
    Powered by <a href="https://solo.b3log.org" target="_blank">YMFED</a>
    <span class="ft-warn">&heartsuit;</span>
    Theme
    <sup>[<a href="javascript:;" target="_blank">ref</a>]</sup>
    by <a href="javascript:;" target="_blank">亚美Web团队</a>
</footer>
<div class="icon-up" onclick="Util.goTop()"></div>
<script>
  var Label = {
    servePath: "https://ymfed.github.io",
    staticServePath: "https://ymfed.github.io",
    luteAvailable: false,
    hljsStyle: 'github',
    langLabel: "zh_CN",
    version: "3.9.0",
    staticSite: true,
    showCodeBlockLn: false,
  }
</script>
<script src="https://ymfed.github.io/skins/9IPHP/js/common.min.js?1585645466987"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.6/index.css"/>
<script async src="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.6/index.js"></script>
<div class="solo-kanbanniang">
    <div class="solo-kanbanniang__tip"></div>
    <canvas id="soloKanbanniang" width="280" height="250"></canvas>
    <div class="solo-kanbanniang__tool">
        <svg id="soloKanbanniangHome" viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32 18.967l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18.516v12h-8v-8h-8v8h-8v-12l12-9z"></path>
        </svg>
        <svg id="soloKanbanniangRSS" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M320.364 768q0 45.728-32 77.728t-77.728 32-77.728-32-32-77.728 32-77.728 77.728-32 77.728 32 32 77.728zM612.94 838.272q1.152 16-9.728 27.424-10.272 12-26.848 12h-77.152q-14.272 0-24.576-9.44t-11.424-23.712q-12.576-130.848-105.44-223.712t-223.712-105.44q-14.272-1.152-23.712-11.424t-9.44-24.576V402.24q0-16.576 12-26.848 9.728-9.728 24.576-9.728h2.848q91.424 7.424 174.848 46.016t148 103.712q65.152 64.576 103.712 148t46.016 174.848z m292.576 1.152q1.152 15.424-10.272 26.848-10.272 11.424-26.272 11.424h-81.728q-14.848 0-25.44-10.016t-11.136-24.288q-6.848-122.848-57.728-233.44t-132.288-192-192-132.288-233.44-58.272q-14.272-0.576-24.288-11.136t-10.016-24.864V109.664q0-16 11.424-26.272 10.272-10.272 25.152-10.272h1.728q149.728 7.424 286.56 68.576t243.136 168q106.848 106.272 168 243.136t68.576 286.56z"></path>
        </svg>
        <svg id="soloKanbanniangChat" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M802.42709 96.163153H219.476155c-84.48109 0-154.896836 71.746044-154.896836 157.840888v393.119449c0 86.072331 70.415746 157.819398 154.896836 157.819399h214.038818V925.470963s22.526039 40.168862 64.767096 5.734608c30.965246-25.819039 126.721123-91.828428 171.775248-123.385145h132.369773c84.502579 0 154.896836-83.21526 154.896836-157.839865V251.125481c0-86.094844-70.394257-154.962328-154.896836-154.962328zM301.144176 518.002714c-39.427988 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044 39.426965 0 70.393233 31.577183 70.393234 71.746044 0 40.169885-30.966269 71.746044-70.393234 71.746044z m208.411657 0c-39.450501 0-70.415746-31.576159-70.415746-71.746044 0-40.168862 30.965246-71.746044 70.415746-71.746044 39.405475 0 70.394257 31.577183 70.394257 71.746044 0 40.169885-30.988782 71.746044-70.394257 71.746044z m211.203236 0c-39.426965 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044s70.415746 31.577183 70.415746 71.746044c-0.001023 40.169885-30.988782 71.746044-70.415746 71.746044z"></path>
        </svg>
        <svg id="soloKanbanniangChange" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M936.672 193.216l-226.88-64c-8.704-2.528-18.112-1.12-25.824 3.776-7.68 4.864-12.896 12.736-14.432 21.728C655.712 236.928 595.328 288 512 288c-71.424 0-142.464-103.296-163.776-143.104-7.136-13.28-22.528-19.84-37.024-15.68l-224 64C73.472 197.152 64 209.728 64 224v256a31.93 31.93 0 0 0 11.712 24.736c7.392 6.08 17.152 8.512 26.56 6.624L224 487.04V832c0 52.928 43.072 96 96 96h384c52.928 0 96-43.072 96-96V519.04l121.728 24.352c9.44 1.92 19.2-0.544 26.56-6.624C955.68 530.656 960 521.6 960 512V224c0-14.336-9.536-26.912-23.328-30.784zM672 800H352c-17.664 0-32-14.304-32-32s14.336-32 32-32h320c17.696 0 32 14.304 32 32s-14.304 32-32 32z"></path>
        </svg>
        <svg id="soloKanbanniangPhoto" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M898.048 258.048q23.552-1.024 46.592 9.216t40.96 27.136 28.672 39.424 10.752 46.08l0 390.144q0 24.576-10.752 47.104t-28.672 40.448-40.96 28.16-47.616 10.24l-697.344 0q-24.576 0-48.64-10.24t-42.496-27.648-29.696-40.448-11.264-48.64l0-381.952q0-22.528 10.752-45.568t28.672-41.472 39.936-30.208 44.544-11.776l63.488 0 13.312-83.968q3.072-20.48 18.432-32.768t34.816-12.288l456.704 0q19.456 0 34.304 10.752t16.896 34.304l14.336 83.968 54.272 0zM548.864 712.704q40.96 0 77.824-15.872t63.488-42.496 42.496-62.976 15.872-77.312-15.872-77.312-42.496-62.976-63.488-42.496-77.824-15.872-77.312 15.872-63.488 42.496-43.008 62.976-15.872 77.312 15.872 77.312 43.008 62.976 63.488 42.496 77.312 15.872z"></path>
        </svg>
        <svg id="soloKanbanniangGithub" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M1024 524.8c0 114.346667-32.554667 217.216-97.706667 308.565333-65.066667 91.306667-149.162667 154.538667-252.288 189.610667-11.989333 2.304-20.778667 0.682667-26.325333-4.778667a27.605333 27.605333 0 0 1-8.362667-20.48v-144.213333c0-44.16-11.52-76.501333-34.645333-97.024 25.344-2.730667 48.085333-6.826667 68.309333-12.288a268.629333 268.629333 0 0 0 62.72-26.666667 187.434667 187.434667 0 0 0 53.973334-45.44c14.421333-18.005333 26.197333-41.898667 35.328-71.765333 9.088-29.824 13.653333-64.128 13.653333-102.826667 0-55.125333-17.536-102.058667-52.650667-140.8 16.426667-41.429333 14.677333-87.893333-5.333333-139.392-12.458667-4.096-30.464-1.578667-54.016 7.509334a355.328 355.328 0 0 0-61.312 30.08L640 271.274667a462.336 462.336 0 0 0-128-17.749334c-43.989333 0-86.656 5.930667-128 17.749334a589.824 589.824 0 0 0-28.330667-18.432c-11.776-7.253333-30.336-16.042667-55.68-26.325334-25.344-10.24-44.416-13.312-57.301333-9.216-19.584 51.498667-21.12 97.962667-4.693333 139.434667-35.114667 38.698667-52.650667 85.632-52.650667 140.757333 0 38.698667 4.565333 72.874667 13.653333 102.485334 9.130667 29.610667 20.778667 53.546667 34.986667 71.765333 14.250667 18.218667 32.128 33.493333 53.674667 45.781333 21.546667 12.288 42.453333 21.205333 62.677333 26.666667 20.224 5.461333 43.008 9.557333 68.309333 12.288-17.749333 16.384-28.629333 39.850667-32.64 70.4a130.005333 130.005333 0 0 1-29.994666 10.24c-10.666667 2.261333-23.338667 3.413333-37.973334 3.413333-14.72 0-29.269333-4.906667-43.690666-14.677333-14.464-9.813333-26.794667-24.064-36.992-42.709333a109.226667 109.226667 0 0 0-32.341334-35.541334c-13.141333-9.130667-24.106667-14.592-33.024-16.426666l-13.312-2.048c-9.344 0-15.786667 1.024-19.328 3.072-3.584 2.090667-4.693333 4.693333-3.328 7.893333 1.28 3.157333 3.328 6.4 5.973334 9.557333 2.688 3.2 5.546667 5.930667 8.661333 8.192l4.693333 3.413334c9.770667 4.565333 19.413333 13.226667 29.013334 25.984 9.514667 12.757333 16.512 24.362667 20.992 34.858666l6.656 15.701334c5.76 17.322667 15.530667 31.317333 29.312 42.026666 13.781333 10.666667 28.672 17.536 44.672 20.48 16 2.986667 31.445333 4.565333 46.336 4.821334 14.890667 0.213333 27.221333-0.597333 36.992-2.389334l15.36-2.730666c0 17.28 0.085333 37.546667 0.298666 60.8l0.341334 36.906666a27.050667 27.050667 0 0 1-8.661334 20.48c-5.76 5.461333-14.677333 7.082667-26.666666 4.778667-103.125333-35.072-187.221333-98.261333-252.330667-189.610667C32.554667 742.058667 0 639.146667 0 524.8c0-95.232 22.869333-183.04 68.693333-263.466667A516.266667 516.266667 0 0 1 254.976 70.4C333.44 23.466667 419.114667 0 512 0c92.885333 0 178.56 23.466667 256.981333 70.4a516.266667 516.266667 0 0 1 186.368 190.976C1001.130667 341.802667 1024 429.653333 1024 524.842667z"></path>
        </svg>
        <svg id="soloKanbanniangClose" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M517.572566143763 1018.6748601482986C238.26554897656422 1018.6748601482986 11.897910175114305 792.2714997690043 11.897910175114305 513.0002041796496c0-279.3070171671984 226.36763880144977-505.71037754649296 505.6746559686481-505.71037754649296 279.2712955893538 0 505.6746559686481 226.40336037929444 505.6746559686481 505.71037754649296C1023.2472221124112 792.2714997690043 796.8795833109612 1018.6748601482986 517.572566143763 1018.6748601482986zM754.7281214542927 339.25044954334646c13.752807470184345-13.752807470184345 9.680547595895998-40.186775075214015-9.073280772537204-58.94060344364717l-2.143294670678079-2.1075730928334457c-18.7538283684332-18.7538283684332-45.15207439561819-22.861809820566194-58.90488186580257-9.073280772537204l-168.21291007038468 168.24863164822932-180.42968969324974-180.46541127109438c-13.967136937252159-13.967136937252159-40.72259874288353-9.823433907274534-59.72647815622916 9.216167083915742l-2.143294670678079 2.143294670678079c-19.039600991190277 19.003879413345654-23.111860865478626 45.75934121897699-9.180445506071107 59.655035000539876l180.42968969324974 180.46541127109438-176.07165719620428 176.03593561835962c-13.788529048028984 13.824250625873615-9.716269173740633 40.151053497369375 9.073280772537204 58.94060344364717l2.1075730928334457 2.1075730928334457c18.7538283684332 18.7538283684332 45.15207439561819 22.897531398410823 58.90488186580257 9.073280772537204l176.10737877404887-176.10737877404887 170.39192631890742 170.42764789675192c13.967136937252159 13.931415359407513 40.686877165038865 9.85915548511917 59.690756578384516-9.180445506071107l2.1790162485227142-2.1790162485227142c19.039600991190277-18.968157835501014 23.147582443323273-45.72361964113239 9.180445506071107-59.690756578384516l-170.39192631890742-170.42764789675192L754.7281214542927 339.25044954334646z"></path>
        </svg>
    </div>
</div>

<script type="text/javascript">
    Util.addScript('https://ymfed.github.io/js/page.min.js?1585645466987', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论内容只能为 2 到 500 个字符！",
        "oId": "1571292082263",
        "blogHost": "https://ymfed.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "0";
    Skin.initToc()
    page.share()
    });
</script>
</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 29ms, 2020/06/24 15:11:34 -->